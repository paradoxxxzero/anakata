var Prototype={Version:"1.6.1",Browser:function(){var a=navigator.userAgent,b=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!b,Opera:b,WebKit:a.indexOf("AppleWebKit/")>-1,Gecko:a.indexOf("Gecko")>-1&&a.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile.*Safari/.test(a)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var a=window.Element||window.HTMLElement;return!!(a&&a.prototype)}(),
SpecificElementExtensions:function(){if(typeof window.HTMLDivElement!=="undefined")return true;var a=document.createElement("div"),b=document.createElement("form"),d=false;if(a.__proto__&&a.__proto__!==b.__proto__)d=true;return d}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=false;
var Abstract={},Try={these:function(){for(var a,b=0,d=arguments.length;b<d;b++){var e=arguments[b];try{a=e();break}catch(f){}}return a}},Class=function(){function a(){}return{create:function(){function b(){this.initialize.apply(this,arguments)}var d=null,e=$A(arguments);if(Object.isFunction(e[0]))d=e.shift();Object.extend(b,Class.Methods);b.superclass=d;b.subclasses=[];if(d){a.prototype=d.prototype;b.prototype=new a;d.subclasses.push(b)}for(d=0;d<e.length;d++)b.addMethods(e[d]);if(!b.prototype.initialize)b.prototype.initialize=
Prototype.emptyFunction;return b.prototype.constructor=b},Methods:{addMethods:function(b){var d=this.superclass&&this.superclass.prototype,e=Object.keys(b);if(!Object.keys({toString:true}).length){b.toString!=Object.prototype.toString&&e.push("toString");b.valueOf!=Object.prototype.valueOf&&e.push("valueOf")}for(var f=0,g=e.length;f<g;f++){var i=e[f],h=b[i];if(d&&Object.isFunction(h)&&h.argumentNames().first()=="$super"){var j=h;h=function(m){return function(){return d[m].apply(this,arguments)}}(i).wrap(j);
h.valueOf=j.valueOf.bind(j);h.toString=j.toString.bind(j)}this.prototype[i]=h}return this}}}}();
(function(){function a(g,i){for(var h in i)g[h]=i[h];return g}function b(g){switch(typeof g){case "undefined":case "function":case "unknown":return;case "boolean":return g.toString()}if(g===null)return"null";if(g.toJSON)return g.toJSON();if(!d(g)){var i=[];for(var h in g){var j=b(g[h]);e(j)||i.push(h.toJSON()+": "+j)}return"{"+i.join(", ")+"}"}}function d(g){return!!(g&&g.nodeType==1)}function e(g){return typeof g==="undefined"}var f=Object.prototype.toString;a(Object,{extend:a,inspect:function(g){try{if(e(g))return"undefined";
if(g===null)return"null";return g.inspect?g.inspect():String(g)}catch(i){if(i instanceof RangeError)return"...";throw i;}},toJSON:b,toQueryString:function(g){return $H(g).toQueryString()},toHTML:function(g){return g&&g.toHTML?g.toHTML():String.interpret(g)},keys:function(g){var i=[];for(var h in g)i.push(h);return i},values:function(g){var i=[];for(var h in g)i.push(g[h]);return i},clone:function(g){return a({},g)},isElement:d,isArray:function(g){return f.call(g)=="[object Array]"},isHash:function(g){return g instanceof
Hash},isFunction:function(g){return typeof g==="function"},isString:function(g){return f.call(g)=="[object String]"},isNumber:function(g){return f.call(g)=="[object Number]"},isUndefined:e})})();
Object.extend(Function.prototype,function(){function a(e,f){for(var g=e.length,i=f.length;i--;)e[g+i]=f[i];return e}function b(e,f){e=d.call(e,0);return a(e,f)}var d=Array.prototype.slice;return{argumentNames:function(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return e.length==1&&!e[0]?[]:e},bind:function(e){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var f=this,g=d.call(arguments,
1);return function(){var i=b(g,arguments);return f.apply(e,i)}},bindAsEventListener:function(e){var f=this,g=d.call(arguments,1);return function(i){i=a([i||window.event],g);return f.apply(e,i)}},curry:function(){if(!arguments.length)return this;var e=this,f=d.call(arguments,0);return function(){var g=b(f,arguments);return e.apply(this,g)}},delay:function(e){var f=this,g=d.call(arguments,1);e*=1E3;return window.setTimeout(function(){return f.apply(f,g)},e)},defer:function(){return this.delay.apply(this,
a([0.01],arguments))},wrap:function(e){var f=this;return function(){var g=a([f.bind(this)],arguments);return e.apply(this,g)}},methodize:function(){if(this._methodized)return this._methodized;var e=this;return this._methodized=function(){var f=a([this],arguments);return e.apply(null,f)}}}}());
Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+'Z"'};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};
var PeriodicalExecuter=Class.create({initialize:function(a,b){this.callback=a;this.frequency=b;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1E3)},execute:function(){this.callback(this)},stop:function(){if(this.timer){clearInterval(this.timer);this.timer=null}},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(a){this.currentlyExecuting=
false;throw a;}}});Object.extend(String,{interpret:function(a){return a==null?"":String(a)},specialChar:{"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","\\":"\\\\"}});
Object.extend(String.prototype,function(){function a(e){if(Object.isFunction(e))return e;var f=new Template(e);return function(g){return f.evaluate(g)}}function b(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function d(e){var f=this.strip().match(/([^?#]*)(#.*)?$/);if(!f)return{};return f[1].split(e||"&").inject({},function(g,i){if((i=i.split("="))[0]){var h=decodeURIComponent(i.shift()),j=i.length>1?i.join("="):i[0];if(j!=undefined)j=decodeURIComponent(j);if(h in g){Object.isArray(g[h])||
(g[h]=[g[h]]);g[h].push(j)}else g[h]=j}return g})}return{gsub:function(e,f){var g="",i=this,h;f=a(f);if(Object.isString(e))e=RegExp.escape(e);if(!(e.length||e.source)){f=f("");return f+i.split("").join(f)+f}for(;i.length>0;)if(h=i.match(e)){g+=i.slice(0,h.index);g+=String.interpret(f(h));i=i.slice(h.index+h[0].length)}else{g+=i;i=""}return g},sub:function(e,f,g){f=a(f);g=Object.isUndefined(g)?1:g;return this.gsub(e,function(i){if(--g<0)return i[0];return f(i)})},scan:function(e,f){this.gsub(e,f);
return String(this)},truncate:function(e,f){e=e||30;f=Object.isUndefined(f)?"...":f;return this.length>e?this.slice(0,e-f.length)+f:String(this)},strip:String.prototype.trim?String.prototype.trim:b,stripTags:function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var e=new RegExp(Prototype.ScriptFragment,"img"),f=new RegExp(Prototype.ScriptFragment,"im");
return(this.match(e)||[]).map(function(g){return(g.match(f)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(e){return eval(e)})},escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},toQueryParams:d,parseQuery:d,toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-
1)+1)},times:function(e){return e<1?"":(new Array(e+1)).join(this)},camelize:function(){var e=this.split("-"),f=e.length;if(f==1)return e[0];for(var g=this.charAt(0)=="-"?e[0].charAt(0).toUpperCase()+e[0].substring(1):e[0],i=1;i<f;i++)g+=e[i].charAt(0).toUpperCase()+e[i].substring(1);return g},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,
"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/_/g,"-")},inspect:function(e){var f=this.replace(/[\x00-\x1f\\]/g,function(g){if(g in String.specialChar)return String.specialChar[g];return"\\u00"+g.charCodeAt().toPaddedString(2,16)});if(e)return'"'+f.replace(/"/g,'\\"')+'"';return"'"+f.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(e){return this.replace(e||Prototype.JSONFilter,"$1")},isJSON:function(){var e;if(this.blank())return false;
e=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(e)},evalJSON:function(e){var f=this.unfilterJSON();try{if(!e||f.isJSON())return eval("("+f+")")}catch(g){}throw new SyntaxError("Badly formed JSON string: "+this.inspect());},include:function(e){return this.indexOf(e)>-1},startsWith:function(e){return this.indexOf(e)===0},endsWith:function(e){var f=this.length-e.length;return f>=0&&this.lastIndexOf(e)===f},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},
interpolate:function(e,f){return(new Template(this,f)).evaluate(e)}}}());
var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){if(a&&Object.isFunction(a.toTemplateReplacements))a=a.toTemplateReplacements();return this.template.gsub(this.pattern,function(b){if(a==null)return b[1]+"";var d=b[1]||"";if(d=="\\")return b[2];var e=a,f=b[3],g=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;b=g.exec(f);if(b==null)return d;for(;b!=null;){var i=b[1].startsWith("[")?b[2].replace(/\\\\]/g,"]"):b[1];e=e[i];if(null==
e||""==b[3])break;f=f.substring("["==b[3]?b[1].length:b[0].length);b=g.exec(f)}return d+String.interpret(e)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;
var $break={},Enumerable=function(){function a(h,j){h=h||Prototype.K;var m=true;this.each(function(u,w){m=m&&!!h.call(j,u,w);if(!m)throw $break;});return m}function b(h,j){h=h||Prototype.K;var m=false;this.each(function(u,w){if(m=!!h.call(j,u,w))throw $break;});return m}function d(h,j){h=h||Prototype.K;var m=[];this.each(function(u,w){m.push(h.call(j,u,w))});return m}function e(h,j){var m;this.each(function(u,w){if(h.call(j,u,w)){m=u;throw $break;}});return m}function f(h,j){var m=[];this.each(function(u,
w){h.call(j,u,w)&&m.push(u)});return m}function g(h){if(Object.isFunction(this.indexOf))if(this.indexOf(h)!=-1)return true;var j=false;this.each(function(m){if(m==h){j=true;throw $break;}});return j}function i(){return this.map()}return{each:function(h,j){var m=0;try{this._each(function(w){h.call(j,w,m++)})}catch(u){if(u!=$break)throw u;}return this},eachSlice:function(h,j,m){var u=-h,w=[],n=this.toArray();if(h<1)return n;for(;(u+=h)<n.length;)w.push(n.slice(u,u+h));return w.collect(j,m)},all:a,every:a,
any:b,some:b,collect:d,map:d,detect:e,findAll:f,select:f,filter:f,grep:function(h,j,m){j=j||Prototype.K;var u=[];if(Object.isString(h))h=new RegExp(RegExp.escape(h));this.each(function(w,n){h.match(w)&&u.push(j.call(m,w,n))});return u},include:g,member:g,inGroupsOf:function(h,j){j=Object.isUndefined(j)?null:j;return this.eachSlice(h,function(m){for(;m.length<h;)m.push(j);return m})},inject:function(h,j,m){this.each(function(u,w){h=j.call(m,h,u,w)});return h},invoke:function(h){var j=$A(arguments).slice(1);
return this.map(function(m){return m[h].apply(m,j)})},max:function(h,j){h=h||Prototype.K;var m;this.each(function(u,w){u=h.call(j,u,w);if(m==null||u>=m)m=u});return m},min:function(h,j){h=h||Prototype.K;var m;this.each(function(u,w){u=h.call(j,u,w);if(m==null||u<m)m=u});return m},partition:function(h,j){h=h||Prototype.K;var m=[],u=[];this.each(function(w,n){(h.call(j,w,n)?m:u).push(w)});return[m,u]},pluck:function(h){var j=[];this.each(function(m){j.push(m[h])});return j},reject:function(h,j){var m=
[];this.each(function(u,w){h.call(j,u,w)||m.push(u)});return m},sortBy:function(h,j){return this.map(function(m,u){return{value:m,criteria:h.call(j,m,u)}}).sort(function(m,u){var w=m.criteria,n=u.criteria;return w<n?-1:w>n?1:0}).pluck("value")},toArray:i,entries:i,zip:function(){var h=Prototype.K,j=$A(arguments);if(Object.isFunction(j.last()))h=j.pop();var m=[this].concat(j).map($A);return this.map(function(u,w){return h(m.pluck(w))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+
this.toArray().inspect()+">"},find:e}}();function $A(a){if(!a)return[];if("toArray"in Object(a))return a.toArray();for(var b=a.length||0,d=new Array(b);b--;)d[b]=a[b];return d}function $w(a){if(!Object.isString(a))return[];return(a=a.strip())?a.split(/\s+/):[]}Array.from=$A;
(function(){function a(j){for(var m=0,u=this.length;m<u;m++)j(this[m])}function b(){return i.call(this,0)}function d(j,m){m||(m=0);var u=this.length;if(m<0)m=u+m;for(;m<u;m++)if(this[m]===j)return m;return-1}function e(j,m){m=isNaN(m)?this.length:(m<0?this.length+m:m)+1;var u=this.slice(0,m).reverse().indexOf(j);return u<0?u:m-u-1}function f(){for(var j=i.call(this,0),m,u=0,w=arguments.length;u<w;u++){m=arguments[u];if(Object.isArray(m)&&!("callee"in m))for(var n=0,o=m.length;n<o;n++)j.push(m[n]);
else j.push(m)}return j}var g=Array.prototype,i=g.slice,h=g.forEach;h||(h=a);Object.extend(g,Enumerable);if(!g._reverse)g._reverse=g.reverse;Object.extend(g,{_each:h,clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(j){return j!=null})},flatten:function(){return this.inject([],function(j,m){if(Object.isArray(m))return j.concat(m.flatten());j.push(m);return j})},without:function(){var j=
i.call(arguments,0);return this.select(function(m){return!j.include(m)})},reverse:function(j){return(j!==false?this:this.toArray())._reverse()},uniq:function(j){return this.inject([],function(m,u,w){if(0==w||(j?m.last()!=u:!m.include(u)))m.push(u);return m})},intersect:function(j){return this.uniq().findAll(function(m){return j.detect(function(u){return m===u})})},clone:b,toArray:b,size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"},toJSON:function(){var j=
[];this.each(function(m){m=Object.toJSON(m);Object.isUndefined(m)||j.push(m)});return"["+j.join(", ")+"]"}});if(function(){return[].concat(arguments)[0][0]!==1}(1,2))g.concat=f;if(!g.indexOf)g.indexOf=d;if(!g.lastIndexOf)g.lastIndexOf=e})();function $H(a){return new Hash(a)}
var Hash=Class.create(Enumerable,function(){function a(){return Object.clone(this._object)}function b(d,e){if(Object.isUndefined(e))return d;return d+"="+encodeURIComponent(String.interpret(e))}return{initialize:function(d){this._object=Object.isHash(d)?d.toObject():Object.clone(d)},_each:function(d){for(var e in this._object){var f=this._object[e],g=[e,f];g.key=e;g.value=f;d(g)}},set:function(d,e){return this._object[d]=e},get:function(d){if(this._object[d]!==Object.prototype[d])return this._object[d]},
unset:function(d){var e=this._object[d];delete this._object[d];return e},toObject:a,toTemplateReplacements:a,keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(d){var e=this.detect(function(f){return f.value===d});return e&&e.key},merge:function(d){return this.clone().update(d)},update:function(d){return(new Hash(d)).inject(this,function(e,f){e.set(f.key,f.value);return e})},toQueryString:function(){return this.inject([],function(d,e){var f=encodeURIComponent(e.key),
g=e.value;if(g&&typeof g=="object"){if(Object.isArray(g))return d.concat(g.map(b.curry(f)))}else d.push(b(f,g));return d}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(d){return d.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:function(){return Object.toJSON(this.toObject())},clone:function(){return new Hash(this)}}}());Hash.from=$H;
Object.extend(Number.prototype,function(){return{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(a,b){$R(0,this,true).each(a,b);return this},toPaddedString:function(a,b){var d=this.toString(b||10);return"0".times(a-d.length)+d},toJSON:function(){return isFinite(this)?this.toString():"null"},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)}}}());
function $R(a,b,d){return new ObjectRange(a,b,d)}
var ObjectRange=Class.create(Enumerable,function(){return{initialize:function(a,b,d){this.start=a;this.end=b;this.exclusive=d},_each:function(a){for(var b=this.start;this.include(b);){a(b);b=b.succ()}},include:function(a){if(a<this.start)return false;if(this.exclusive)return a<this.end;return a<=this.end}}}()),Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||
false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){this.include(a)||this.responders.push(a)},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(a,b,d,e){this.each(function(f){if(Object.isFunction(f[a]))try{f[a].apply(f,[b,d,e])}catch(g){}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});
Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters))this.options.parameters=this.options.parameters.toQueryParams();else if(Object.isHash(this.options.parameters))this.options.parameters=this.options.parameters.toObject()}});
Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,b,d){$super(d);this.transport=Ajax.getTransport();this.request(b)},request:function(a){this.url=a;this.method=this.options.method;a=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){a._method=this.method;this.method="post"}this.parameters=a;if(a=Object.toQueryString(a))if(this.method=="get")this.url+=(this.url.include("?")?"&":"?")+a;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))a+=
"&_=";try{var b=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(b);Ajax.Responders.dispatch("onCreate",this,b);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||a:null;this.transport.send(this.body);!this.options.asynchronous&&this.transport.overrideMimeType&&
this.onStateChange()}catch(d){this.dispatchException(d)}},onStateChange:function(){var a=this.transport.readyState;a>1&&!(a==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var a={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){a["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:
"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)a.Connection="close"}if(typeof this.options.requestHeaders=="object"){var b=this.options.requestHeaders;if(Object.isFunction(b.push))for(var d=0,e=b.length;d<e;d+=2)a[b[d]]=b[d+1];else $H(b).each(function(g){a[g.key]=g.value})}for(var f in a)this.transport.setRequestHeader(f,a[f])},success:function(){var a=this.getStatus();return!a||a>=200&&a<300},getStatus:function(){try{return this.transport.status||
0}catch(a){return 0}},respondToReadyState:function(a){a=Ajax.Request.Events[a];var b=new Ajax.Response(this);if(a=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(d){this.dispatchException(d)}var e=b.getHeader("Content-type");if(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&e&&e.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))this.evalResponse()}try{(this.options["on"+
a]||Prototype.emptyFunction)(b,b.headerJSON);Ajax.Responders.dispatch("on"+a,this,b,b.headerJSON)}catch(f){this.dispatchException(f)}if(a=="Complete")this.transport.onreadystatechange=Prototype.emptyFunction},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return!a||a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(a){try{return this.transport.getResponseHeader(a)||
null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(a){this.dispatchException(a)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
Ajax.Response=Class.create({initialize:function(a){this.request=a;a=this.transport=a.transport;var b=this.readyState=a.readyState;if(b>2&&!Prototype.Browser.IE||b==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(a.responseText);this.headerJSON=this._getHeaderJSON()}if(b==4){a=a.responseXML;this.responseXML=Object.isUndefined(a)?null:a;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,
getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a)return null;a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||
!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||a.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});
Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,b,d,e){this.container={success:b.success||b,failure:b.failure||(b.success?null:b)};e=Object.clone(e);var f=e.onComplete;e.onComplete=function(g,i){this.updateContent(g.responseText);Object.isFunction(f)&&f(g,i)}.bind(this);$super(d,e)},updateContent:function(a){var b=this.container[this.success()?"success":"failure"],d=this.options;d.evalScripts||(a=a.stripScripts());if(b=$(b))if(d.insertion)if(Object.isString(d.insertion)){var e=
{};e[d.insertion]=a;b.insert(e)}else d.insertion(b,a);else b.update(a)}});
Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,b,d,e){$super(e);this.onComplete=this.options.onComplete;this.frequency=this.options.frequency||2;this.decay=this.options.decay||1;this.updater={};this.container=b;this.url=d;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},
updateComplete:function(a){if(this.options.decay){this.decay=a.responseText==this.lastText?this.decay*this.options.decay:1;this.lastText=a.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(a){if(arguments.length>1){for(var b=0,d=[],e=arguments.length;b<e;b++)d.push($(arguments[b]));return d}if(Object.isString(a))a=document.getElementById(a);return Element.extend(a)}if(Prototype.BrowserFeatures.XPath)document._getElementsByXPath=function(a,b){for(var d=[],e=document.evaluate(a,$(b)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),f=0,g=e.snapshotLength;f<g;f++)d.push(Element.extend(e.snapshotItem(f)));return d};if(!window.Node)var Node={};
Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});
(function(a){var b=function(){var e=document.createElement("form"),f=document.createElement("input"),g=document.documentElement;f.setAttribute("name","test");e.appendChild(f);g.appendChild(e);f=e.elements?typeof e.elements.test=="undefined":null;g.removeChild(e);return f}(),d=a.Element;a.Element=function(e,f){f=f||{};e=e.toLowerCase();var g=Element.cache;if(b&&f.name){e="<"+e+' name="'+f.name+'">';delete f.name;return Element.writeAttribute(document.createElement(e),f)}g[e]||(g[e]=Element.extend(document.createElement(e)));
return Element.writeAttribute(g[e].cloneNode(false),f)};Object.extend(a.Element,d||{});if(d)a.Element.prototype=d.prototype})(this);Element.cache={};Element.idCounter=1;
Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:function(){var a=function(){var e=document.createElement("select"),f=true;e.innerHTML='<option value="test">test</option>';if(e.options&&e.options[0])f=e.options[0].nodeName.toUpperCase()!==
"OPTION";return f}(),b=function(){try{var e=document.createElement("table");if(e&&e.tBodies){e.innerHTML="<tbody><tr><td>test</td></tr></tbody>";return typeof e.tBodies[0]=="undefined"}}catch(f){return true}}(),d=function(){var e=document.createElement("script"),f=false;try{e.appendChild(document.createTextNode(""));f=!e.firstChild||e.firstChild&&e.firstChild.nodeType!==3}catch(g){f=true}return f}();return function(e,f){e=$(e);if(f&&f.toElement)f=f.toElement();if(Object.isElement(f))return e.update().insert(f);
f=Object.toHTML(f);var g=e.tagName.toUpperCase();if(g==="SCRIPT"&&d){e.text=f;return e}if(a||b)if(g in Element._insertionTranslations.tags){for(;e.firstChild;)e.removeChild(e.firstChild);Element._getContentFromAnonymousElement(g,f.stripScripts()).each(function(i){e.appendChild(i)})}else e.innerHTML=f.stripScripts();else e.innerHTML=f.stripScripts();f.evalScripts.bind(f).defer();return e}}(),replace:function(a,b){a=$(a);if(b&&b.toElement)b=b.toElement();else if(!Object.isElement(b)){b=Object.toHTML(b);
var d=a.ownerDocument.createRange();d.selectNode(a);b.evalScripts.bind(b).defer();b=d.createContextualFragment(b.stripScripts())}a.parentNode.replaceChild(b,a);return a},insert:function(a,b){a=$(a);if(Object.isString(b)||Object.isNumber(b)||Object.isElement(b)||b&&(b.toElement||b.toHTML))b={bottom:b};var d,e,f;for(var g in b){d=b[g];g=g.toLowerCase();e=Element._insertionTranslations[g];if(d&&d.toElement)d=d.toElement();if(Object.isElement(d))e(a,d);else{d=Object.toHTML(d);f=(g=="before"||g=="after"?
a.parentNode:a).tagName.toUpperCase();f=Element._getContentFromAnonymousElement(f,d.stripScripts());if(g=="top"||g=="after")f.reverse();f.each(e.curry(a));d.evalScripts.bind(d).defer()}}return a},wrap:function(a,b,d){a=$(a);if(Object.isElement(b))$(b).writeAttribute(d||{});else b=Object.isString(b)?new Element(b,d):new Element("div",b);a.parentNode&&a.parentNode.replaceChild(b,a);b.appendChild(a);return b},inspect:function(a){a=$(a);var b="<"+a.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(d){var e=
d.first();d=d.last();if(e=(a[e]||"").toString())b+=" "+d+"="+e.inspect(true)});return b+">"},recursivelyCollect:function(a,b){a=$(a);for(var d=[];a=a[b];)a.nodeType==1&&d.push(Element.extend(a));return d},ancestors:function(a){return Element.recursivelyCollect(a,"parentNode")},descendants:function(a){return Element.select(a,"*")},firstDescendant:function(a){for(a=$(a).firstChild;a&&a.nodeType!=1;)a=a.nextSibling;return $(a)},immediateDescendants:function(a){if(!(a=$(a).firstChild))return[];for(;a&&
a.nodeType!=1;)a=a.nextSibling;if(a)return[a].concat($(a).nextSiblings());return[]},previousSiblings:function(a){return Element.recursivelyCollect(a,"previousSibling")},nextSiblings:function(a){return Element.recursivelyCollect(a,"nextSibling")},siblings:function(a){a=$(a);return Element.previousSiblings(a).reverse().concat(Element.nextSiblings(a))},match:function(a,b){if(Object.isString(b))b=new Selector(b);return b.match($(a))},up:function(a,b,d){a=$(a);if(arguments.length==1)return $(a.parentNode);
var e=Element.ancestors(a);return Object.isNumber(b)?e[b]:Selector.findElement(e,b,d)},down:function(a,b,d){a=$(a);if(arguments.length==1)return Element.firstDescendant(a);return Object.isNumber(b)?Element.descendants(a)[b]:Element.select(a,b)[d||0]},previous:function(a,b,d){a=$(a);if(arguments.length==1)return $(Selector.handlers.previousElementSibling(a));var e=Element.previousSiblings(a);return Object.isNumber(b)?e[b]:Selector.findElement(e,b,d)},next:function(a,b,d){a=$(a);if(arguments.length==
1)return $(Selector.handlers.nextElementSibling(a));var e=Element.nextSiblings(a);return Object.isNumber(b)?e[b]:Selector.findElement(e,b,d)},select:function(a){var b=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(a,b)},adjacent:function(a){var b=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(a.parentNode,b).without(a)},identify:function(a){a=$(a);var b=Element.readAttribute(a,"id");if(b)return b;do b="anonymous_element_"+Element.idCounter++;while($(b));
Element.writeAttribute(a,"id",b);return b},readAttribute:function(a,b){a=$(a);if(Prototype.Browser.IE){var d=Element._attributeTranslations.read;if(d.values[b])return d.values[b](a,b);if(d.names[b])b=d.names[b];if(b.include(":"))return!a.attributes||!a.attributes[b]?null:a.attributes[b].value}return a.getAttribute(b)},writeAttribute:function(a,b,d){a=$(a);var e={},f=Element._attributeTranslations.write;if(typeof b=="object")e=b;else e[b]=Object.isUndefined(d)?true:d;for(var g in e){b=f.names[g]||
g;d=e[g];if(f.values[g])b=f.values[g](a,d);if(d===false||d===null)a.removeAttribute(b);else d===true?a.setAttribute(b,b):a.setAttribute(b,d)}return a},getHeight:function(a){return Element.getDimensions(a).height},getWidth:function(a){return Element.getDimensions(a).width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(a=$(a)){var d=a.className;return d.length>0&&(d==b||(new RegExp("(^|\\s)"+b+"(\\s|$)")).test(d))}},addClassName:function(a,b){if(a=$(a)){Element.hasClassName(a,
b)||(a.className+=(a.className?" ":"")+b);return a}},removeClassName:function(a,b){if(a=$(a)){a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip();return a}},toggleClassName:function(a,b){if(a=$(a))return Element[Element.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)},cleanWhitespace:function(a){a=$(a);for(var b=a.firstChild;b;){var d=b.nextSibling;b.nodeType==3&&!/\S/.test(b.nodeValue)&&a.removeChild(b);b=d}return a},empty:function(a){return $(a).innerHTML.blank()},
descendantOf:function(a,b){a=$(a);b=$(b);if(a.compareDocumentPosition)return(a.compareDocumentPosition(b)&8)===8;if(b.contains)return b.contains(a)&&b!==a;for(;a=a.parentNode;)if(a==b)return true;return false},scrollTo:function(a){a=$(a);var b=Element.cumulativeOffset(a);window.scrollTo(b[0],b[1]);return a},getStyle:function(a,b){a=$(a);b=b=="float"?"cssFloat":b.camelize();var d=a.style[b];if(!d||d=="auto")d=(d=document.defaultView.getComputedStyle(a,null))?d[b]:null;if(b=="opacity")return d?parseFloat(d):
1;return d=="auto"?null:d},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(a,b){a=$(a);var d=a.style;if(Object.isString(b)){a.style.cssText+=";"+b;return b.include("opacity")?a.setOpacity(b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a}for(var e in b)if(e=="opacity")a.setOpacity(b[e]);else d[e=="float"||e=="cssFloat"?Object.isUndefined(d.styleFloat)?"cssFloat":"styleFloat":e]=b[e];return a},setOpacity:function(a,b){a=$(a);a.style.opacity=b==1||b===""?"":b<1.0E-5?0:b;return a},getDimensions:function(a){a=
$(a);var b=Element.getStyle(a,"display");if(b!="none"&&b!=null)return{width:a.offsetWidth,height:a.offsetHeight};b=a.style;var d=b.visibility,e=b.position,f=b.display;b.visibility="hidden";if(e!="fixed")b.position="absolute";b.display="block";var g=a.clientWidth;a=a.clientHeight;b.display=f;b.position=e;b.visibility=d;return{width:g,height:a}},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b){a._madePositioned=true;a.style.position="relative";if(Prototype.Browser.Opera){a.style.top=
0;a.style.left=0}}return a},undoPositioned:function(a){a=$(a);if(a._madePositioned){a._madePositioned=undefined;a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""}return a},makeClipping:function(a){a=$(a);if(a._overflow)return a;a._overflow=Element.getStyle(a,"overflow")||"auto";if(a._overflow!=="hidden")a.style.overflow="hidden";return a},undoClipping:function(a){a=$(a);if(!a._overflow)return a;a.style.overflow=a._overflow=="auto"?"":a._overflow;a._overflow=null;return a},
cumulativeOffset:function(a){var b=0,d=0;do{b+=a.offsetTop||0;d+=a.offsetLeft||0;a=a.offsetParent}while(a);return Element._returnOffset(d,b)},positionedOffset:function(a){var b=0,d=0;do{b+=a.offsetTop||0;d+=a.offsetLeft||0;if(a=a.offsetParent){if(a.tagName.toUpperCase()=="BODY")break;if(Element.getStyle(a,"position")!=="static")break}}while(a);return Element._returnOffset(d,b)},absolutize:function(a){a=$(a);if(Element.getStyle(a,"position")=="absolute")return a;var b=Element.positionedOffset(a),d=
b[1];b=b[0];var e=a.clientWidth,f=a.clientHeight;a._originalLeft=b-parseFloat(a.style.left||0);a._originalTop=d-parseFloat(a.style.top||0);a._originalWidth=a.style.width;a._originalHeight=a.style.height;a.style.position="absolute";a.style.top=d+"px";a.style.left=b+"px";a.style.width=e+"px";a.style.height=f+"px";return a},relativize:function(a){a=$(a);if(Element.getStyle(a,"position")=="relative")return a;a.style.position="relative";var b=parseFloat(a.style.top||0)-(a._originalTop||0),d=parseFloat(a.style.left||
0)-(a._originalLeft||0);a.style.top=b+"px";a.style.left=d+"px";a.style.height=a._originalHeight;a.style.width=a._originalWidth;return a},cumulativeScrollOffset:function(a){var b=0,d=0;do{b+=a.scrollTop||0;d+=a.scrollLeft||0;a=a.parentNode}while(a);return Element._returnOffset(d,b)},getOffsetParent:function(a){if(a.offsetParent)return $(a.offsetParent);if(a==document.body)return $(a);for(;(a=a.parentNode)&&a!=document.body;)if(Element.getStyle(a,"position")!="static")return $(a);return $(document.body)},
viewportOffset:function(a){var b=0,d=0,e=a;do{b+=e.offsetTop||0;d+=e.offsetLeft||0;if(e.offsetParent==document.body&&Element.getStyle(e,"position")=="absolute")break}while(e=e.offsetParent);e=a;do if(!Prototype.Browser.Opera||e.tagName&&e.tagName.toUpperCase()=="BODY"){b-=e.scrollTop||0;d-=e.scrollLeft||0}while(e=e.parentNode);return Element._returnOffset(d,b)},clonePosition:function(a,b,d){d=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},d||{});b=$(b);
var e=Element.viewportOffset(b);a=$(a);var f=[0,0],g=null;if(Element.getStyle(a,"position")=="absolute"){g=Element.getOffsetParent(a);f=Element.viewportOffset(g)}if(g==document.body){f[0]-=document.body.offsetLeft;f[1]-=document.body.offsetTop}if(d.setLeft)a.style.left=e[0]-f[0]+d.offsetLeft+"px";if(d.setTop)a.style.top=e[1]-f[1]+d.offsetTop+"px";if(d.setWidth)a.style.width=b.offsetWidth+"px";if(d.setHeight)a.style.height=b.offsetHeight+"px";return a}};
Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};
if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(a,b,d){switch(d){case "left":case "top":case "right":case "bottom":if(a(b,"position")==="static")return null;case "height":case "width":if(!Element.visible(b))return null;var e=parseInt(a(b,d),10);if(e!==b["offset"+d.capitalize()])return e+"px";return(d==="height"?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(e,
function(f,g){var i=a(b,g);return i===null?f:f-parseInt(i,10)})+"px";default:return a(b,d)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(a,b,d){if(d==="title")return b.title;return a(b,d)})}else if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(a,b){b=$(b);var d=b.getStyle("position");if(d!=="static")return a(b);b.setStyle({position:"relative"});var e=a(b);b.setStyle({position:d});return e});$w("positionedOffset viewportOffset").each(function(a){Element.Methods[a]=
Element.Methods[a].wrap(function(b,d){d=$(d);var e=d.getStyle("position");if(e!=="static")return b(d);var f=d.getOffsetParent();f&&f.getStyle("position")==="fixed"&&f.setStyle({zoom:1});d.setStyle({position:"relative"});f=b(d);d.setStyle({position:e});return f})});Element.Methods.cumulativeOffset=Element.Methods.cumulativeOffset.wrap(function(a,b){return a(b)});Element.Methods.getStyle=function(a,b){a=$(a);b=b=="float"||b=="cssFloat"?"styleFloat":b.camelize();var d=a.style[b];if(!d&&a.currentStyle)d=
a.currentStyle[b];if(b=="opacity"){if(d=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))if(d[1])return parseFloat(d[1])/100;return 1}if(d=="auto"){if((b=="width"||b=="height")&&a.getStyle("display")!="none")return a["offset"+b.capitalize()]+"px";return null}return d};Element.Methods.setOpacity=function(a,b){a=$(a);var d=a.currentStyle;if(d&&!d.hasLayout||!d&&a.style.zoom=="normal")a.style.zoom=1;d=a.getStyle("filter");var e=a.style;if(b==1||b===""){(d=d.replace(/alpha\([^\)]*\)/gi,""))?
(e.filter=d):e.removeAttribute("filter");return a}else if(b<1.0E-5)b=0;e.filter=d.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+b*100+")";return a};Element._attributeTranslations=function(){var a="className",b="for",d=document.createElement("div");d.setAttribute(a,"x");if(d.className!=="x"){d.setAttribute("class","x");if(d.className==="x")a="class"}d=null;d=document.createElement("label");d.setAttribute(b,"x");if(d.htmlFor!=="x"){d.setAttribute("htmlFor","x");if(d.htmlFor==="x")b="htmlFor"}d=null;
return{read:{names:{"class":a,className:a,"for":b,htmlFor:b},values:{_getAttr:function(e,f){return e.getAttribute(f)},_getAttr2:function(e,f){return e.getAttribute(f,2)},_getAttrNode:function(e,f){var g=e.getAttributeNode(f);return g?g.value:""},_getEv:function(){var e=document.createElement("div");e.onclick=Prototype.emptyFunction;e=e.getAttribute("onclick");var f;if(String(e).indexOf("{")>-1)f=function(g,i){i=g.getAttribute(i);if(!i)return null;i=i.toString();i=i.split("{")[1];i=i.split("}")[0];
return i.strip()};else if(e==="")f=function(g,i){i=g.getAttribute(i);if(!i)return null;return i.strip()};e=null;return f}(),_flag:function(e,f){return $(e).hasAttribute(f)?f:null},style:function(e){return e.style.cssText.toLowerCase()},title:function(e){return e.title}}}}}();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,b){a.style.cssText=
b?b:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=a;Element._attributeTranslations.has[a.toLowerCase()]=a});(function(a){Object.extend(a,{href:a._getAttr2,src:a._getAttr2,type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,onclick:a._getEv,
ondblclick:a._getEv,onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})})(Element._attributeTranslations.read.values);Prototype.BrowserFeatures.ElementExtensions&&function(){Element.Methods.down=function(a,b,d){a=$(a);if(arguments.length==1)return a.firstDescendant();var e;if(Object.isNumber(b)){e=
a.getElementsByTagName("*");for(var f=[],g=0,i;i=e[g];g++)i.tagName!=="!"&&f.push(i);e=f[b]}else e=Element.select(a,b)[d||0];return e}}()}else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent))Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=b==1?0.999999:b===""?"":b<1.0E-5?0:b;return a};else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=b==1||b===""?"":b<1.0E-5?0:b;if(b==1)if(a.tagName.toUpperCase()=="IMG"&&a.width){a.width++;
a.width--}else try{var d=document.createTextNode(" ");a.appendChild(d);a.removeChild(d)}catch(e){}return a};Element.Methods.cumulativeOffset=function(a){var b=0,d=0;do{b+=a.offsetTop||0;d+=a.offsetLeft||0;if(a.offsetParent==document.body)if(Element.getStyle(a,"position")=="absolute")break;a=a.offsetParent}while(a);return Element._returnOffset(d,b)}}
if("outerHTML"in document.documentElement)Element.Methods.replace=function(a,b){a=$(a);if(b&&b.toElement)b=b.toElement();if(Object.isElement(b)){a.parentNode.replaceChild(b,a);return a}b=Object.toHTML(b);var d=a.parentNode,e=d.tagName.toUpperCase();if(Element._insertionTranslations.tags[e]){var f=a.next();e=Element._getContentFromAnonymousElement(e,b.stripScripts());d.removeChild(a);f?e.each(function(g){d.insertBefore(g,f)}):e.each(function(g){d.appendChild(g)})}else a.outerHTML=b.stripScripts();
b.evalScripts.bind(b).defer();return a};Element._returnOffset=function(a,b){var d=[a,b];d.left=a;d.top=b;return d};Element._getContentFromAnonymousElement=function(a,b){var d=new Element("div"),e=Element._insertionTranslations.tags[a];if(e){d.innerHTML=e[0]+b+e[1];e[2].times(function(){d=d.firstChild})}else d.innerHTML=b;return $A(d.childNodes)};
Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};
(function(){var a=Element._insertionTranslations.tags;Object.extend(a,{THEAD:a.TBODY,TFOOT:a.TBODY,TH:a.TD})})();Element.Methods.Simulated={hasAttribute:function(a,b){b=Element._attributeTranslations.has[b]||b;var d=$(a).getAttributeNode(b);return!!(d&&d.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);
(function(a){if(!Prototype.BrowserFeatures.ElementExtensions&&a.__proto__){window.HTMLElement={};window.HTMLElement.prototype=a.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}})(document.createElement("div"));
Element.extend=function(){function a(f,g){for(var i in g){var h=g[i];if(Object.isFunction(h)&&!(i in f))f[i]=h.methodize()}}var b=function(f){if(typeof window.Element!="undefined"){var g=window.Element.prototype;if(g){var i="_"+(Math.random()+"").slice(2);f=document.createElement(f);g[i]="x";f=f[i]!=="x";delete g[i];return f}}return false}("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(b)return function(f){if(f&&typeof f._extendedByPrototype=="undefined"){var g=f.tagName;if(g&&
/^(?:object|applet|embed)$/i.test(g)){a(f,Element.Methods);a(f,Element.Methods.Simulated);a(f,Element.Methods.ByTag[g.toUpperCase()])}}return f};return Prototype.K}var d={},e=Element.Methods.ByTag;b=Object.extend(function(f){if(!f||typeof f._extendedByPrototype!="undefined"||f.nodeType!=1||f==window)return f;var g=Object.clone(d),i=f.tagName.toUpperCase();e[i]&&Object.extend(g,e[i]);a(f,g);f._extendedByPrototype=Prototype.emptyFunction;return f},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(d,
Element.Methods);Object.extend(d,Element.Methods.Simulated)}}});b.refresh();return b}();Element.hasAttribute=function(a,b){if(a.hasAttribute)return a.hasAttribute(b);return Element.Methods.Simulated.hasAttribute(a,b)};
Element.addMethods=function(a){function b(j){j=j.toUpperCase();Element.Methods.ByTag[j]||(Element.Methods.ByTag[j]={});Object.extend(Element.Methods.ByTag[j],a)}function d(j,m,u){u=u||false;for(var w in j){var n=j[w];if(Object.isFunction(n))if(!u||!(w in m))m[w]=n.methodize()}}function e(j){var m,u={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",
Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(u[j])m="HTML"+u[j]+"Element";if(window[m])return window[m];m="HTML"+j+"Element";if(window[m])return window[m];m="HTML"+j.capitalize()+"Element";if(window[m])return window[m];j=document.createElement(j);return j.__proto__||j.constructor.prototype}
var f=Prototype.BrowserFeatures,g=Element.Methods.ByTag;if(!a){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var i=a;a=arguments[1]}if(i)Object.isArray(i)?i.each(b):b(i);else Object.extend(Element.Methods,a||{});i=window.HTMLElement?HTMLElement.prototype:
Element.prototype;if(f.ElementExtensions){d(Element.Methods,i);d(Element.Methods.Simulated,i,true)}if(f.SpecificElementExtensions)for(var h in Element.Methods.ByTag){f=e(h);Object.isUndefined(f)||d(g[h],f.prototype)}Object.extend(Element,Element.Methods);delete Element.ByTag;Element.extend.refresh&&Element.extend.refresh();Element.cache={}};
document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};
(function(a){function b(){if(e.WebKit&&!f.evaluate)return document;if(e.Opera&&window.parseFloat(window.opera.version())<9.5)return document.body;return document.documentElement}function d(h){g||(g=b());i[h]="client"+h;a["get"+h]=function(){return g[i[h]]};return a["get"+h]()}var e=Prototype.Browser,f=document,g,i={};a.getWidth=d.curry("Width");a.getHeight=d.curry("Height")})(document.viewport);Element.Storage={UID:1};
Element.addMethods({getStorage:function(a){if(a=$(a)){if(a===window)a=0;else{if(typeof a._prototypeUID==="undefined")a._prototypeUID=[Element.Storage.UID++];a=a._prototypeUID[0]}Element.Storage[a]||(Element.Storage[a]=$H());return Element.Storage[a]}},store:function(a,b,d){if(a=$(a)){arguments.length===2?Element.getStorage(a).update(b):Element.getStorage(a).set(b,d);return a}},retrieve:function(a,b,d){if(a=$(a)){a=Element.getStorage(a);var e=a.get(b);if(Object.isUndefined(e)){a.set(b,d);e=d}return e}},
clone:function(a,b){if(a=$(a)){var d=a.cloneNode(b);d._prototypeUID=void 0;if(b)for(var e=Element.select(d,"*"),f=e.length;f--;)e[f]._prototypeUID=void 0;return Element.extend(d)}}});
var Selector=Class.create({initialize:function(a){this.expression=a.strip();if(this.shouldUseSelectorsAPI())this.mode="selectorsAPI";else if(this.shouldUseXPath()){this.mode="xpath";this.compileXPathMatcher()}else{this.mode="normal";this.compileMatcher()}},shouldUseXPath:function(){var a=function(){var b=false;if(document.evaluate&&window.XPathResult){b=document.createElement("div");b.innerHTML="<ul><li></li></ul><div><ul><li></li></ul></div>";b=document.evaluate(".//*[local-name()='ul' or local-name()='UL']//*[local-name()='li' or local-name()='LI']",
b,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength!==2}return b}();return function(){if(!Prototype.BrowserFeatures.XPath)return false;var b=this.expression;if(Prototype.Browser.WebKit&&(b.include("-of-type")||b.include(":empty")))return false;if(/(\[[\w-]*?:|:checked)/.test(b))return false;if(a)return false;return true}}(),shouldUseSelectorsAPI:function(){if(!Prototype.BrowserFeatures.SelectorsAPI)return false;if(Selector.CASE_INSENSITIVE_CLASS_NAMES)return false;if(!Selector._div)Selector._div=
new Element("div");try{Selector._div.querySelector(this.expression)}catch(a){return false}return true},compileMatcher:function(){var a=this.expression,b=Selector.patterns,d=Selector.criteria,e,f,g=b.length,i;if(Selector._cache[a])this.matcher=Selector._cache[a];else{for(this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];a&&e!=a&&/\S/.test(a);){e=a;for(var h=0;h<g;h++){f=b[h].re;i=b[h].name;if(f=a.match(f)){this.matcher.push(Object.isFunction(d[i])?
d[i](f):(new Template(d[i])).evaluate(f));a=a.replace(f[0],"");break}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher}},compileXPathMatcher:function(){var a=this.expression,b=Selector.patterns,d=Selector.xpath,e,f,g=b.length,i;if(Selector._cache[a])this.xpath=Selector._cache[a];else{for(this.matcher=[".//*"];a&&e!=a&&/\S/.test(a);){e=a;for(var h=0;h<g;h++){i=b[h].name;if(f=a.match(b[h].re)){this.matcher.push(Object.isFunction(d[i])?
d[i](f):(new Template(d[i])).evaluate(f));a=a.replace(f[0],"");break}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath}},findElements:function(a){a=a||document;var b=this.expression;switch(this.mode){case "selectorsAPI":if(a!==document){var d=a.id,e=$(a).identify();e=e.replace(/([\.:])/g,"\\$1");b="#"+e+" "+b}b=$A(a.querySelectorAll(b)).map(Element.extend);a.id=d;return b;case "xpath":return document._getElementsByXPath(this.xpath,a);default:return this.matcher(a)}},match:function(a){this.tokens=
[];for(var b=this.expression,d=Selector.patterns,e=Selector.assertions,f,g,i=d.length,h;b&&f!==b&&/\S/.test(b);){f=b;for(var j=0;j<i;j++){g=d[j].re;h=d[j].name;if(g=b.match(g))if(e[h]){this.tokens.push([h,Object.clone(g)]);b=b.replace(g[0],"")}else return this.findElements(document).include(a)}}b=true;for(j=0;d=this.tokens[j];j++){h=d[0];d=d[1];if(!Selector.assertions[h](a,d)){b=false;break}}return b},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+
">"}});if(Prototype.BrowserFeatures.SelectorsAPI&&document.compatMode==="BackCompat")Selector.CASE_INSENSITIVE_CLASS_NAMES=function(){var a=document.createElement("div"),b=document.createElement("span");a.id="prototype_test_id";b.className="Test";a.appendChild(b);return a.querySelector("#prototype_test_id .test")!==null}();
Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(a){if(a[1]=="*")return"";return"[local-name()='"+a[1].toLowerCase()+"' or local-name()='"+a[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(a){a[1]=a[1].toLowerCase();return(new Template("[@#{1}]")).evaluate(a)},attr:function(a){a[1]=a[1].toLowerCase();a[3]=a[5]||a[6];
return(new Template(Selector.xpath.operators[a[2]])).evaluate(a)},pseudo:function(a){var b=Selector.xpath.pseudos[a[1]];if(!b)return"";if(Object.isFunction(b))return b(a);return(new Template(Selector.xpath.pseudos[a[1]])).evaluate(a)},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},
pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]",empty:"[count(*) = 0 and (count(text()) = 0)]",checked:"[@checked]",disabled:"[(@disabled) and (@type!='hidden')]",enabled:"[not(@disabled) and (@type!='hidden')]",not:function(a){for(var b=a[6],d=Selector.patterns,e=Selector.xpath,f,g,i=d.length,h=[];b&&f!=b&&/\S/.test(b);){f=b;for(var j=0;j<i;j++){g=d[j].name;if(a=b.match(d[j].re)){g=
Object.isFunction(e[g])?e[g](a):(new Template(e[g])).evaluate(a);h.push("("+g.substring(1,g.length-1)+")");b=b.replace(a[0],"");break}}}return"[not("+h.join(" and ")+")]"},"nth-child":function(a){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",a)},"nth-last-child":function(a){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",a)},"nth-of-type":function(a){return Selector.xpath.pseudos.nth("position() ",a)},"nth-last-of-type":function(a){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",
a)},"first-of-type":function(a){a[6]="1";return Selector.xpath.pseudos["nth-of-type"](a)},"last-of-type":function(a){a[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](a)},"only-of-type":function(a){var b=Selector.xpath.pseudos;return b["first-of-type"](a)+b["last-of-type"](a)},nth:function(a,b){var d,e=b[6];if(e=="even")e="2n+0";if(e=="odd")e="2n+1";if(d=e.match(/^(\d+)$/))return"["+a+"= "+d[1]+"]";if(d=e.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(d[1]=="-")d[1]=-1;e=d[1]?Number(d[1]):1;d=d[2]?
Number(d[2]):0;return(new Template("[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]")).evaluate({fragment:a,a:e,b:d})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(a){a[3]=a[5]||a[6];return(new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;')).evaluate(a)},
pseudo:function(a){if(a[6])a[6]=a[6].replace(/"/g,'\\"');return(new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;')).evaluate(a)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:[{name:"laterSibling",re:/^\s*~\s*/},{name:"child",re:/^\s*>\s*/},{name:"adjacent",re:/^\s*\+\s*/},{name:"descendant",re:/^\s/},{name:"tagName",re:/^\s*(\*|[\w\-]+)(\b|$)?/},{name:"id",re:/^#([\w\-\*]+)(\b|$)/},{name:"className",re:/^\.([\w\-\*]+)(\b|$)/},
{name:"pseudo",re:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/},{name:"attrPresence",re:/^\[((?:[\w-]+:)?[\w-]+)\]/},{name:"attr",re:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/}],assertions:{tagName:function(a,b){return b[1].toUpperCase()==a.tagName.toUpperCase()},className:function(a,b){return Element.hasClassName(a,b[1])},id:function(a,b){return a.id===b[1]},attrPresence:function(a,b){return Element.hasAttribute(a,
b[1])},attr:function(a,b){var d=Element.readAttribute(a,b[1]);return d&&Selector.operators[b[2]](d,b[5]||b[6])}},handlers:{concat:function(a,b){for(var d=0,e;e=b[d];d++)a.push(e);return a},mark:function(a){for(var b=Prototype.emptyFunction,d=0,e;e=a[d];d++)e._countedByPrototype=b;return a},unmark:function(){return function(){var a=document.createElement("div"),b=false;a._countedByPrototype="x";return b=a.getAttribute("_countedByPrototype")==="x"}()?function(a){for(var b=0,d;d=a[b];b++)d.removeAttribute("_countedByPrototype");
return a}:function(a){for(var b=0,d;d=a[b];b++)d._countedByPrototype=void 0;return a}}(),index:function(a,b,d){a._countedByPrototype=Prototype.emptyFunction;if(b){a=a.childNodes;b=a.length-1;for(var e=1;b>=0;b--){var f=a[b];if(f.nodeType==1&&(!d||f._countedByPrototype))f.nodeIndex=e++}}else{b=0;e=1;for(a=a.childNodes;f=a[b];b++)if(f.nodeType==1&&(!d||f._countedByPrototype))f.nodeIndex=e++}},unique:function(a){if(a.length==0)return a;for(var b=[],d,e=0,f=a.length;e<f;e++)if(typeof(d=a[e])._countedByPrototype==
"undefined"){d._countedByPrototype=Prototype.emptyFunction;b.push(Element.extend(d))}return Selector.handlers.unmark(b)},descendant:function(a){for(var b=Selector.handlers,d=0,e=[],f;f=a[d];d++)b.concat(e,f.getElementsByTagName("*"));return e},child:function(a){for(var b=0,d=[],e;e=a[b];b++)for(var f=0,g;g=e.childNodes[f];f++)g.nodeType==1&&g.tagName!="!"&&d.push(g);return d},adjacent:function(a){for(var b=0,d=[],e;e=a[b];b++)(e=this.nextElementSibling(e))&&d.push(e);return d},laterSibling:function(a){for(var b=
Selector.handlers,d=0,e=[],f;f=a[d];d++)b.concat(e,Element.nextSiblings(f));return e},nextElementSibling:function(a){for(;a=a.nextSibling;)if(a.nodeType==1)return a;return null},previousElementSibling:function(a){for(;a=a.previousSibling;)if(a.nodeType==1)return a;return null},tagName:function(a,b,d,e){var f=d.toUpperCase(),g=[],i=Selector.handlers;if(a){if(e){if(e=="descendant"){for(b=0;e=a[b];b++)i.concat(g,e.getElementsByTagName(d));return g}else a=this[e](a);if(d=="*")return a}for(b=0;e=a[b];b++)e.tagName.toUpperCase()===
f&&g.push(e);return g}else return b.getElementsByTagName(d)},id:function(a,b,d,e){var f=$(d),g=Selector.handlers;if(b==document){if(!f)return[];if(!a)return[f]}else if(!b.sourceIndex||b.sourceIndex<1){a=b.getElementsByTagName("*");for(var i=0,h;h=a[i];i++)if(h.id===d)return[h]}if(a){if(e)if(e=="child")for(b=0;h=a[b];b++){if(f.parentNode==h)return[f]}else if(e=="descendant")for(b=0;h=a[b];b++){if(Element.descendantOf(f,h))return[f]}else if(e=="adjacent")for(b=0;h=a[b];b++){if(Selector.handlers.previousElementSibling(f)==
h)return[f]}else a=g[e](a);for(b=0;h=a[b];b++)if(h==f)return[f];return[]}return f&&Element.descendantOf(f,b)?[f]:[]},className:function(a,b,d,e){if(a&&e)a=this[e](a);return Selector.handlers.byClassName(a,b,d)},byClassName:function(a,b,d){a||(a=Selector.handlers.descendant([b]));b=0;for(var e=[],f,g;f=a[b];b++){g=f.className;if(g.length!=0)if(g==d||(" "+g+" ").include(" "+d+" "))e.push(f)}return e},attrPresence:function(a,b,d,e){a||(a=b.getElementsByTagName("*"));if(a&&e)a=this[e](a);b=[];e=0;for(var f;f=
a[e];e++)Element.hasAttribute(f,d)&&b.push(f);return b},attr:function(a,b,d,e,f,g){a||(a=b.getElementsByTagName("*"));if(a&&g)a=this[g](a);b=Selector.operators[f];f=[];g=0;for(var i;i=a[g];g++){var h=Element.readAttribute(i,d);h!==null&&b(h,e)&&f.push(i)}return f},pseudo:function(a,b,d,e,f){if(a&&f)a=this[f](a);a||(a=e.getElementsByTagName("*"));return Selector.pseudos[b](a,d,e)}},pseudos:{"first-child":function(a){for(var b=0,d=[],e;e=a[b];b++)Selector.handlers.previousElementSibling(e)||d.push(e);
return d},"last-child":function(a){for(var b=0,d=[],e;e=a[b];b++)Selector.handlers.nextElementSibling(e)||d.push(e);return d},"only-child":function(a){for(var b=Selector.handlers,d=0,e=[],f;f=a[d];d++)!b.previousElementSibling(f)&&!b.nextElementSibling(f)&&e.push(f);return e},"nth-child":function(a,b,d){return Selector.pseudos.nth(a,b,d)},"nth-last-child":function(a,b,d){return Selector.pseudos.nth(a,b,d,true)},"nth-of-type":function(a,b,d){return Selector.pseudos.nth(a,b,d,false,true)},"nth-last-of-type":function(a,
b,d){return Selector.pseudos.nth(a,b,d,true,true)},"first-of-type":function(a,b,d){return Selector.pseudos.nth(a,"1",d,false,true)},"last-of-type":function(a,b,d){return Selector.pseudos.nth(a,"1",d,true,true)},"only-of-type":function(a,b,d){var e=Selector.pseudos;return e["last-of-type"](e["first-of-type"](a,b,d),b,d)},getIndices:function(a,b,d){if(a==0)return b>0?[b]:[];return $R(1,d).inject([],function(e,f){0==(f-b)%a&&(f-b)/a>=0&&e.push(f);return e})},nth:function(a,b,d,e,f){if(a.length==0)return[];
if(b=="even")b="2n+0";if(b=="odd")b="2n+1";d=Selector.handlers;var g=[],i=[],h;d.mark(a);for(var j=0;h=a[j];j++)if(!h.parentNode._countedByPrototype){d.index(h.parentNode,e,f);i.push(h.parentNode)}if(b.match(/^\d+$/)){b=Number(b);for(j=0;h=a[j];j++)h.nodeIndex==b&&g.push(h)}else if(h=b.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(h[1]=="-")h[1]=-1;j=h[1]?Number(h[1]):1;h=h[2]?Number(h[2]):0;b=Selector.pseudos.getIndices(j,h,a.length);j=0;for(e=b.length;h=a[j];j++)for(f=0;f<e;f++)h.nodeIndex==b[f]&&g.push(h)}d.unmark(a);
d.unmark(i);return g},empty:function(a){for(var b=0,d=[],e;e=a[b];b++)e.tagName=="!"||e.firstChild||d.push(e);return d},not:function(a,b,d){var e=Selector.handlers;b=(new Selector(b)).findElements(d);e.mark(b);d=0;for(var f=[],g;g=a[d];d++)g._countedByPrototype||f.push(g);e.unmark(b);return f},enabled:function(a){for(var b=0,d=[],e;e=a[b];b++)if(!e.disabled&&(!e.type||e.type!=="hidden"))d.push(e);return d},disabled:function(a){for(var b=0,d=[],e;e=a[b];b++)e.disabled&&d.push(e);return d},checked:function(a){for(var b=
0,d=[],e;e=a[b];b++)e.checked&&d.push(e);return d}},operators:{"=":function(a,b){return a==b},"!=":function(a,b){return a!=b},"^=":function(a,b){return a==b||a&&a.startsWith(b)},"$=":function(a,b){return a==b||a&&a.endsWith(b)},"*=":function(a,b){return a==b||a&&a.include(b)},"~=":function(a,b){return(" "+a+" ").include(" "+b+" ")},"|=":function(a,b){return("-"+(a||"").toUpperCase()+"-").include("-"+(b||"").toUpperCase()+"-")}},split:function(a){var b=[];a.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,
function(d){b.push(d[1].strip())});return b},matchElements:function(a,b){var d=$$(b),e=Selector.handlers;e.mark(d);for(var f=0,g=[],i;i=a[f];f++)i._countedByPrototype&&g.push(i);e.unmark(d);return g},findElement:function(a,b,d){if(Object.isNumber(b)){d=b;b=false}return Selector.matchElements(a,b||"*")[d||0]},findChildElements:function(a,b){b=Selector.split(b.join(","));for(var d=[],e=Selector.handlers,f=0,g=b.length,i;f<g;f++){i=new Selector(b[f].strip());e.concat(d,i.findElements(a))}return g>1?
e.unique(d):d}});Prototype.Browser.IE&&Object.extend(Selector.handlers,{concat:function(a,b){for(var d=0,e;e=b[d];d++)e.tagName!=="!"&&a.push(e);return a}});function $$(){return Selector.findChildElements(document,$A(arguments))}
var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(a,b){if(typeof b!="object")b={hash:!!b};else if(Object.isUndefined(b.hash))b.hash=true;var d,e,f=false,g=b.submit,i=a.inject({},function(h,j){if(!j.disabled&&j.name){d=j.name;e=$(j).getValue();if(e!=null&&j.type!="file"&&(j.type!="submit"||!f&&g!==false&&(!g||d==g)&&(f=true)))if(d in h){Object.isArray(h[d])||(h[d]=[h[d]]);h[d].push(e)}else h[d]=e}return h});return b.hash?i:Object.toQueryString(i)}};
Form.Methods={serialize:function(a,b){return Form.serializeElements(Form.getElements(a),b)},getElements:function(a){a=$(a).getElementsByTagName("*");for(var b,d=[],e=Form.Element.Serializers,f=0;b=a[f];f++)d.push(b);return d.inject([],function(g,i){e[i.tagName.toLowerCase()]&&g.push(Element.extend(i));return g})},getInputs:function(a,b,d){a=$(a);a=a.getElementsByTagName("input");if(!b&&!d)return $A(a).map(Element.extend);for(var e=0,f=[],g=a.length;e<g;e++){var i=a[e];b&&i.type!=b||d&&i.name!=d||
f.push(Element.extend(i))}return f},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(a){a=$(a).getElements().findAll(function(d){return"hidden"!=d.type&&!d.disabled});var b=a.findAll(function(d){return d.hasAttribute("tabIndex")&&d.tabIndex>=0}).sortBy(function(d){return d.tabIndex}).first();return b?b:a.find(function(d){return/^(?:input|select|textarea)$/i.test(d.tagName)})},
focusFirstElement:function(a){a=$(a);a.findFirstElement().activate();return a},request:function(a,b){a=$(a);b=Object.clone(b||{});var d=b.parameters,e=a.readAttribute("action")||"";if(e.blank())e=window.location.href;b.parameters=a.serialize(true);if(d){if(Object.isString(d))d=d.toQueryParams();Object.extend(b.parameters,d)}if(a.hasAttribute("method")&&!b.method)b.method=a.method;return new Ajax.Request(e,b)}};
Form.Element={focus:function(a){$(a).focus();return a},select:function(a){$(a).select();return a}};
Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=undefined){var d={};d[a.name]=b;return Object.toQueryString(d)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){a=$(a);var d=a.tagName.toLowerCase();Form.Element.Serializers[d](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return $(a).value!=""},activate:function(a){a=$(a);try{a.focus();
if(a.select&&(a.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(a.type)))a.select()}catch(b){}return a},disable:function(a){a=$(a);a.disabled=true;return a},enable:function(a){a=$(a);a.disabled=false;return a}};var Field=Form.Element,$F=Form.Element.Methods.getValue;
Form.Element.Serializers={input:function(a,b){switch(a.type.toLowerCase()){case "checkbox":case "radio":return Form.Element.Serializers.inputSelector(a,b);default:return Form.Element.Serializers.textarea(a,b)}},inputSelector:function(a,b){if(Object.isUndefined(b))return a.checked?a.value:null;else a.checked=!!b},textarea:function(a,b){if(Object.isUndefined(b))return a.value;else a.value=b},select:function(a,b){if(Object.isUndefined(b))return this[a.type=="select-one"?"selectOne":"selectMany"](a);
else for(var d,e,f=!Object.isArray(b),g=0,i=a.length;g<i;g++){d=a.options[g];e=this.optionValue(d);if(f){if(e==b){d.selected=true;return}}else d.selected=b.include(e)}},selectOne:function(a){var b=a.selectedIndex;return b>=0?this.optionValue(a.options[b]):null},selectMany:function(a){var b,d=a.length;if(!d)return null;var e=0;for(b=[];e<d;e++){var f=a.options[e];f.selected&&b.push(this.optionValue(f))}return b},optionValue:function(a){return Element.extend(a).hasAttribute("value")?a.value:a.text}};
Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,b,d,e){$super(e,d);this.element=$(b);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a)){this.callback(this.element,a);this.lastValue=a}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});
Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});
Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var a=this.getValue();if(this.lastValue!=a){this.callback(this.element,a);this.lastValue=a}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type)switch(a.type.toLowerCase()){case "checkbox":case "radio":Event.observe(a,
"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this));break}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
(function(){function a(l){var r=document.documentElement,v=document.body||{scrollLeft:0};return l.pageX||l.clientX+(r.scrollLeft||v.scrollLeft)-(r.clientLeft||0)}function b(l){var r=document.documentElement,v=document.body||{scrollTop:0};return l.pageY||l.clientY+(r.scrollTop||v.scrollTop)-(r.clientTop||0)}function d(l,r,v){var y=Element.retrieve(l,"prototype_event_registry");if(Object.isUndefined(y)){p.push(l);y=Element.retrieve(l,"prototype_event_registry",$H())}var z=y.get(r);if(Object.isUndefined(z)){z=
[];y.set(r,z)}if(z.pluck("handler").include(v))return false;var B;if(r.include(":"))B=function(x){if(Object.isUndefined(x.eventName))return false;if(x.eventName!==r)return false;h.extend(x,l);v.call(l,x)};else if(!m&&(r==="mouseenter"||r==="mouseleave")){if(r==="mouseenter"||r==="mouseleave")B=function(x){h.extend(x,l);for(var A=x.relatedTarget;A&&A!==l;)try{A=A.parentNode}catch(C){A=l}A!==l&&v.call(l,x)}}else B=function(x){h.extend(x,l);v.call(l,x)};B.handler=v;z.push(B);return B}function e(){for(var l=
0,r=p.length;l<r;l++){h.stopObserving(p[l]);p[l]=null}}function f(l,r,v){l=$(l);v=d(l,r,v);if(!v)return l;if(r.include(":"))if(l.addEventListener)l.addEventListener("dataavailable",v,false);else{l.attachEvent("ondataavailable",v);l.attachEvent("onfilterchange",v)}else{r=q(r);l.addEventListener?l.addEventListener(r,v,false):l.attachEvent("on"+r,v)}return l}function g(l,r,v){l=$(l);var y=Element.retrieve(l,"prototype_event_registry");if(Object.isUndefined(y))return l;if(r&&!v){var z=y.get(r);if(Object.isUndefined(z))return l;
z.each(function(A){Element.stopObserving(l,r,A.handler)});return l}else if(!r){y.each(function(A){var C=A.key;A.value.each(function(D){Element.stopObserving(l,C,D.handler)})});return l}if(z=y.get(r)){var B=z.find(function(A){return A.handler===v});if(!B)return l;var x=q(r);if(r.include(":"))if(l.removeEventListener)l.removeEventListener("dataavailable",B,false);else{l.detachEvent("ondataavailable",B);l.detachEvent("onfilterchange",B)}else l.removeEventListener?l.removeEventListener(x,B,false):l.detachEvent("on"+
x,B);y.set(r,z.without(B));return l}}function i(l,r,v,y){l=$(l);if(Object.isUndefined(y))y=true;if(l==document&&document.createEvent&&!l.dispatchEvent)l=document.documentElement;var z;if(document.createEvent){z=document.createEvent("HTMLEvents");z.initEvent("dataavailable",true,true)}else{z=document.createEventObject();z.eventType=y?"ondataavailable":"onfilterchange"}z.eventName=r;z.memo=v||{};document.createEvent?l.dispatchEvent(z):l.fireEvent(z.eventType,z);return h.extend(z)}var h={KEY_BACKSPACE:8,
KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},j=document.documentElement,m="onmouseenter"in j&&"onmouseleave"in j,u;if(Prototype.Browser.IE){var w={0:1,1:4,2:2};u=function(l,r){return l.button===w[r]}}else u=Prototype.Browser.WebKit?function(l,r){switch(r){case 0:return l.which==1&&!l.metaKey;case 1:return l.which==1&&l.metaKey;default:return false}}:function(l,r){return l.which?
l.which===r+1:l.button===r};h.Methods={isLeftClick:function(l){return u(l,0)},isMiddleClick:function(l){return u(l,1)},isRightClick:function(l){return u(l,2)},element:function(l){l=h.extend(l);var r=l.target,v=l.type;if((l=l.currentTarget)&&l.tagName)if(v==="load"||v==="error"||v==="click"&&l.tagName.toLowerCase()==="input"&&l.type==="radio")r=l;if(r.nodeType==Node.TEXT_NODE)r=r.parentNode;return Element.extend(r)},findElement:function(l,r){var v=h.element(l);if(!r)return v;v=[v].concat(v.ancestors());
return Selector.findElement(v,r,0)},pointer:function(l){return{x:a(l),y:b(l)}},pointerX:a,pointerY:b,stop:function(l){h.extend(l);l.preventDefault();l.stopPropagation();l.stopped=true}};var n=Object.keys(h.Methods).inject({},function(l,r){l[r]=h.Methods[r].methodize();return l});if(Prototype.Browser.IE){var o=function(l){switch(l.type){case "mouseover":l=l.fromElement;break;case "mouseout":l=l.toElement;break;default:return null}return Element.extend(l)};Object.extend(n,{stopPropagation:function(){this.cancelBubble=
true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});h.extend=function(l,r){if(!l)return false;if(l._extendedByPrototype)return l;l._extendedByPrototype=Prototype.emptyFunction;var v=h.pointer(l);Object.extend(l,{target:l.srcElement||r,relatedTarget:o(l),pageX:v.x,pageY:v.y});return Object.extend(l,n)}}else{h.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(h.prototype,n);h.extend=Prototype.K}var p=[];Prototype.Browser.IE&&
window.attachEvent("onunload",e);Prototype.Browser.WebKit&&window.addEventListener("unload",Prototype.emptyFunction,false);var q=Prototype.K;m||(q=function(l){var r={mouseenter:"mouseover",mouseleave:"mouseout"};return l in r?r[l]:l});Object.extend(h,h.Methods);Object.extend(h,{fire:i,observe:f,stopObserving:g});Element.addMethods({fire:i,observe:f,stopObserving:g});Object.extend(document,{fire:i.methodize(),observe:f.methodize(),stopObserving:g.methodize(),loaded:false});if(window.Event)Object.extend(window.Event,
h);else window.Event=h})();
(function(){function a(){if(!document.loaded){e&&window.clearTimeout(e);document.loaded=true;document.fire("dom:loaded")}}function b(){if(document.readyState==="complete"){document.stopObserving("readystatechange",b);a()}}function d(){try{document.documentElement.doScroll("left")}catch(f){e=d.defer();return}a()}var e;if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,false);else{document.observe("readystatechange",b);if(window==top)e=d.defer()}Event.observe(window,"load",
a)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;
var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||
document.documentElement.scrollTop||document.body.scrollTop||0},within:function(a,b,d){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(a,b,d);this.xcomp=b;this.ycomp=d;this.offset=Element.cumulativeOffset(a);return d>=this.offset[1]&&d<this.offset[1]+a.offsetHeight&&b>=this.offset[0]&&b<this.offset[0]+a.offsetWidth},withinIncludingScrolloffsets:function(a,b,d){var e=Element.cumulativeScrollOffset(a);this.xcomp=b+e[0]-this.deltaX;this.ycomp=d+e[1]-this.deltaY;this.offset=Element.cumulativeOffset(a);
return this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+a.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+a.offsetWidth},overlap:function(a,b){if(!a)return 0;if(a=="vertical")return(this.offset[1]+b.offsetHeight-this.ycomp)/b.offsetHeight;if(a=="horizontal")return(this.offset[0]+b.offsetWidth-this.xcomp)/b.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},
relativize:function(a){Position.prepare();return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(a,b,d){d=d||{};return Element.clonePosition(b,a,d)}};
if(!document.getElementsByClassName)document.getElementsByClassName=function(a){function b(d){return d.blank()?null:"[contains(concat(' ', @class, ' '), ' "+d+" ')]"}a.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(d,e){e=e.toString().strip();var f=/\s/.test(e)?$w(e).map(b).join(""):b(e);return f?document._getElementsByXPath(".//*"+f,d):[]}:function(d,e){e=e.toString().strip();var f=[],g=/\s/.test(e)?$w(e):null;if(!g&&!e)return f;for(var i=$(d).getElementsByTagName("*"),h=0,j,m;j=
i[h];h++)if(j.className&&(m=" "+j.className+" ")&&(m.include(" "+e+" ")||g&&g.all(function(u){return!u.toString().blank()&&m.include(" "+u+" ")})))f.push(Element.extend(j));return f};return function(d,e){return $(e||document.body).getElementsByClassName(d)}}(Element.Methods);Element.ClassNames=Class.create();
Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(b){return b.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){this.include(a)||this.set($A(this).concat(a).join(" "))},remove:function(a){this.include(a)&&this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);var S2={Version:"2.0.0_a6",Extensions:{}};
Function.prototype.optionize=function(){var a=this,b=a.argumentNames(),d=this.length-1,e=function(){var f=$A(arguments),g=typeof f.last()==="object"?f.pop():{},i=[];if(d>0)i=(f.length>0?f:[null]).inGroupsOf(d).flatten().concat(g);return a.apply(this,i)};e.argumentNames=function(){return b};return e};Function.ABSTRACT=function(){throw"Abstract method. Implement in subclass.";};
Object.extend(Number.prototype,{constrain:function(a,b){var d=a<b?a:b,e=a<b?b:a,f=Number(this);if(f<d)f=d;if(f>e)f=e;return f},nearer:function(a,b){var d=Number(this);return Math.abs(d-a)<Math.abs(d-b)?a:b},tween:function(a,b){return this+(a-this)*b}});Object.propertize=function(a,b){return Object.isString(a)?b[a]:a};
S2.CSS={PROPERTY_MAP:{backgroundColor:"color",borderBottomColor:"color",borderBottomWidth:"length",borderLeftColor:"color",borderLeftWidth:"length",borderRightColor:"color",borderRightWidth:"length",borderSpacing:"length",borderTopColor:"color",borderTopWidth:"length",bottom:"length",color:"color",fontSize:"length",fontWeight:"integer",height:"length",left:"length",letterSpacing:"length",lineHeight:"length",marginBottom:"length",marginLeft:"length",marginRight:"length",marginTop:"length",maxHeight:"length",
maxWidth:"length",minHeight:"length",minWidth:"length",opacity:"number",outlineColor:"color",outlineOffset:"length",outlineWidth:"length",paddingBottom:"length",paddingLeft:"length",paddingRight:"length",paddingTop:"length",right:"length",textIndent:"length",top:"length",width:"length",wordSpacing:"length",zIndex:"integer",zoom:"number"},LENGTH:/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/,NUMBER:/([\+-]*\d+\.?\d*)/,__parseStyleElement:document.createElement("div"),parseStyle:function(a){S2.CSS.__parseStyleElement.innerHTML=
'<div style="'+a+'"></div>';var b=S2.CSS.__parseStyleElement.childNodes[0].style,d={};S2.CSS.NUMERIC_PROPERTIES.each(function(e){if(b[e])d[e]=b[e]});S2.CSS.COLOR_PROPERTIES.each(function(e){if(b[e])d[e]=S2.CSS.colorFromString(b[e])});if(Prototype.Browser.IE&&a.include("opacity"))d.opacity=a.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1];return d},normalizeColor:function(a){if(!a||a=="rgba(0, 0, 0, 0)"||a=="transparent")a="#ffffff";a=S2.CSS.colorFromString(a);return[parseInt(a.slice(1,3),16),parseInt(a.slice(3,
5),16),parseInt(a.slice(5,7),16)]},colorFromString:function(a,b){var d="#",e,f;if(a.slice(0,4)=="rgb("){e=a.slice(4,a.length-1).split(",");for(f=3;f--;)d+=parseInt(e[2-f]).toColorPart()}else if(a.slice(0,1)=="#"){if(a.length==4)for(f=1;f<4;f++)d+=(a.charAt(f)+a.charAt(f)).toLowerCase();if(a.length==7)d=a.toLowerCase()}else d=a;return d.length==7?d:b||d},interpolateColor:function(a,b,d){a=S2.CSS.normalizeColor(a);b=S2.CSS.normalizeColor(b);return"#"+[0,1,2].map(function(e){return Math.max(Math.min(a[e].tween(b[e],
d).round(),255),0).toColorPart()}).join("")},interpolateNumber:function(a,b,d){return 1*(a||0).tween(b,d).toFixed(3)},interpolateLength:function(a,b,d){if(!a||parseFloat(a)===0)a="0"+b.gsub(S2.CSS.NUMBER,"");b.scan(S2.CSS.NUMBER,function(e){b=1*e[1]});return a.gsub(S2.CSS.NUMBER,function(e){return(1*parseFloat(e[1]).tween(b,d).toFixed(3)).toString()})},interpolateInteger:function(a,b,d){return parseInt(a).tween(b,d).round()},interpolate:function(a,b,d,e){return S2.CSS["interpolate"+S2.CSS.PROPERTY_MAP[a.camelize()].capitalize()](b,
d,e)},ElementMethods:{getStyles:function(a){var b=document.defaultView.getComputedStyle($(a),null);return S2.CSS.PROPERTIES.inject({},function(d,e){d[e]=b[e];return d})}}};S2.CSS.PROPERTIES=[];for(property in S2.CSS.PROPERTY_MAP)S2.CSS.PROPERTIES.push(property);S2.CSS.NUMERIC_PROPERTIES=S2.CSS.PROPERTIES.findAll(function(a){return!a.endsWith("olor")});S2.CSS.COLOR_PROPERTIES=S2.CSS.PROPERTIES.findAll(function(a){return a.endsWith("olor")});
if(!(document.defaultView&&document.defaultView.getComputedStyle))S2.CSS.ElementMethods.getStyles=function(a){a=$(a);var b=a.currentStyle,d;d=S2.CSS.PROPERTIES.inject({},function(e,f){e[f]=b[f];return e});if(!d.opacity)d.opacity=a.getOpacity();return d};Element.addMethods(S2.CSS.ElementMethods);
S2.FX=function(){function a(i){f[(g+=i)>0?"start":"stop"]()}function b(){d.invoke("render",f.getTimestamp())}var d=[],e,f,g=0;return{initialize:function(i){if(!e){d.push(e=new S2.FX.Queue);S2.FX.DefaultOptions.queue=e;f=i||new S2.FX.Heartbeat;document.observe("effect:heartbeat",b).observe("effect:queued",a.curry(1)).observe("effect:dequeued",a.curry(-1))}},getQueues:function(){return d},addQueue:function(i){d.push(i)},getHeartbeat:function(){return f},setHeartbeat:function(i){f=i}}}();
Object.extend(S2.FX,{DefaultOptions:{transition:"sinusoidal",position:"parallel",fps:60,duration:0.2},elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},parseOptions:function(a){if(Object.isNumber(a))a={duration:a};else if(Object.isFunction(a))a={after:a};else if(Object.isString(a))a={duration:a=="slow"?1:a=="fast"?0.1:0.2};return a||{}}});
S2.FX.Base=Class.create({initialize:function(a){S2.FX.initialize();this.updateWithoutWrappers=this.update;a&&a.queue&&!S2.FX.getQueues().include(a.queue)&&S2.FX.addQueue(a.queue);this.setOptions(a);this.duration=this.options.duration*1E3;this.state="idle";["after","before"].each(function(b){this[b]=function(d){d(this);return this}},this)},setOptions:function(a){a=S2.FX.parseOptions(a);if(!this.options){this.options=Object.extend(Object.extend({},S2.FX.DefaultOptions),a);if(a.tween)this.options.transition=
a.tween}if(this.options.beforeUpdate||this.options.afterUpdate)this.update=this.updateWithoutWrappers.wrap(function(b,d){this.options.beforeUpdate&&this.options.beforeUpdate(this,d);b(d);this.options.afterUpdate&&this.options.afterUpdate(this,d)}.bind(this));if(this.options.transition===false)this.options.transition=S2.FX.Transitions.linear;this.options.transition=Object.propertize(this.options.transition,S2.FX.Transitions)},play:function(a){this.setOptions(a);this.frameCount=0;this.options.queue.add(this);
this.maxFrames=this.options.fps*this.duration/1E3;return this},render:function(a){if(a>=this.startsAt){if(this.state=="idle"){this.options.before&&this.options.before(this);this.setup&&this.setup();this.state="running";this.update(this.options.transition(0));this.frameCount++;return this}if(a>=this.endsAt&&this.state!="finished"){this.update(this.options.transition(1));this.teardown&&this.teardown();this.options.after&&this.options.after(this);this.state="finished"}else if(this.state=="running"){a=
1-(this.endsAt-a)/this.duration;if((this.maxFrames*a).floor()>this.frameCount){this.update(this.options.transition(a));this.frameCount++}}}return this},cancel:function(a){if(!this.state!="running"){this.teardown&&this.teardown();a&&this.options.after&&this.options.after(this);this.state="finished"}},finish:function(){if(!this.state!="running"){this.update(this.options.transition(1));this.cancel(true)}},inspect:function(){return"#<S2.FX:"+[this.state,this.startsAt,this.endsAt].inspect()+">"},update:Prototype.emptyFunction});
S2.FX.Element=Class.create(S2.FX.Base,{initialize:function($super,b,d){if(!(this.element=$(b)))throw S2.FX.elementDoesNotExistError;this.operators=[];return $super(d)},animate:function(){var a=$A(arguments),b=a.shift();b=b.charAt(0).toUpperCase()+b.substring(1);this.operators.push(new S2.FX.Operators[b](this,a[0],a[1]||{}))},play:function($super,b,d){if(b)this.element=$(b);return $super(d)},update:function(a){this.operators.invoke("render",a)}});
S2.FX.Heartbeat=Class.create({initialize:function(a){this.options=Object.extend({framerate:Prototype.Browser.MobileSafari?20:60},a);this.beat=this.beat.bind(this)},start:function(){if(!this.heartbeatInterval){this.heartbeatInterval=setInterval(this.beat,1E3/this.options.framerate);this.updateTimestamp()}},stop:function(){if(this.heartbeatInterval){clearInterval(this.heartbeatInterval);this.timestamp=this.heartbeatInterval=null}},beat:function(){this.updateTimestamp();document.fire("effect:heartbeat")},
getTimestamp:function(){return this.timestamp||this.generateTimestamp()},generateTimestamp:function(){return(new Date).getTime()},updateTimestamp:function(){this.timestamp=this.generateTimestamp()}});
S2.FX.Queue=function(){return function(){function a(d){b=b.without(d);delete d;document.fire("effect:dequeued",this);return this}var b=[];Object.extend(this,{getEffects:function(){return b},active:function(){return b.length>0},add:function(d){var e=d.options.position||"parallel",f=S2.FX.getHeartbeat().getTimestamp();if(e=="end")f=b.without(d).pluck("endsAt").max()||f;d.startsAt=f+(d.options.delay||0)*1E3;d.endsAt=d.startsAt+(d.options.duration||1)*1E3;b.push(d);document.fire("effect:queued",this);
return this},remove:a,render:function(d){b.invoke("render",d);b.select(function(e){return e.state=="finished"}).each(a);return this}})}}();S2.FX.Attribute=Class.create(S2.FX.Base,{initialize:function($super,b,d,e,f,g){b=Object.isString(b)?$(b):b;this.method=Object.isFunction(g)?g.bind(b):Object.isFunction(b[g])?b[g].bind(b):function(i){b[g]=i};this.to=e;this.from=d;return $super(f)},update:function(a){this.method(this.from.tween(this.to,a))}});
S2.FX.Style=Class.create(S2.FX.Element,{setup:function(){this.animate("style",this.element,{style:this.options.style})}});S2.FX.Operators={};
S2.FX.Operators.Base=Class.create({initialize:function(a,b,d){this.effect=a;this.object=b;this.options=Object.extend({transition:Prototype.K},d)},inspect:function(){return"#<S2.FX.Operators.Base:"+this.lastValue+">"},setup:function(){},valueAt:function(){},applyValue:function(){},render:function(a){a=this.valueAt(this.options.transition(a));this.applyValue(a);this.lastValue=a}});
S2.FX.Operators.Style=Class.create(S2.FX.Operators.Base,{initialize:function($super,b,d,e){$super(b,d,e);this.element=$(this.object);this.style=Object.isString(this.options.style)?S2.CSS.parseStyle(this.options.style):this.options.style;this.tweens=[];for(var f in this.style){b=f.underscore().dasherize();d=this.element.getStyle(b);e=this.style[f];if(d!=e)this.tweens.push([b,S2.CSS.interpolate.curry(b,d,e),f in this.options.propertyTransitions?Object.propertize(this.options.propertyTransitions[f],
S2.FX.Transitions):Prototype.K])}},valueAt:function(a){return this.tweens.map(function(b){return b[0]+":"+b[1](b[2](a))}).join(";")},applyValue:function(a){if(this.currentStyle!=a){this.element.setStyle(a);this.currentStyle=a}}});
S2.FX.Morph=Class.create(S2.FX.Element,{setup:function(){if(this.options.change)this.setupWrappers();else if(this.options.style)this.animate("style",this.destinationElement||this.element,{style:this.options.style,propertyTransitions:this.options.propertyTransitions||{}})},teardown:function(){this.options.change&&this.teardownWrappers()},setupWrappers:function(){var a=this.element.getStyle("float"),b,d,e,f;this.transitionElement=(new Element("div")).setStyle({position:"relative",overflow:"hidden",
"float":a});this.element.setStyle({"float":"none"}).insert({before:this.transitionElement});this.sourceElementWrapper=this.element.cloneWithoutIDs().wrap("div");this.destinationElementWrapper=this.element.wrap("div");this.transitionElement.insert(this.sourceElementWrapper).insert(this.destinationElementWrapper);a=this.sourceElementWrapper.getHeight();b=this.sourceElementWrapper.getWidth();this.options.change();d=this.destinationElementWrapper.getHeight();e=this.destinationElementWrapper.getWidth();
this.outerWrapper=new Element("div");this.transitionElement.insert({before:this.outerWrapper});this.outerWrapper.setStyle({overflow:"hidden",height:a+"px",width:b+"px"}).appendChild(this.transitionElement);f=Math.max(d,a);maxWidth=Math.max(e,b);this.transitionElement.setStyle({height:a+"px",width:b+"px"});this.sourceElementWrapper.setStyle({position:"absolute",height:f+"px",width:maxWidth+"px",top:0,left:0});this.destinationElementWrapper.setStyle({position:"absolute",height:f+"px",width:maxWidth+
"px",top:0,left:0,opacity:0,zIndex:2E3});this.outerWrapper.insert({before:this.transitionElement}).remove();this.animate("style",this.transitionElement,{style:"height:"+d+"px; width:"+e+"px"});this.animate("style",this.destinationElementWrapper,{style:"opacity: 1.0"})},teardownWrappers:function(){var a=this.destinationElementWrapper.down();a&&this.transitionElement.insert({before:a});this.transitionElement.remove()}});
S2.FX.Parallel=Class.create(S2.FX.Base,{initialize:function($super,b,d){this.effects=b||[];return $super(d||{})},setup:function(){this.effects.invoke("setup")},update:function(a){this.effects.invoke("update",a)}});S2.FX.Operators.Scroll=Class.create(S2.FX.Operators.Base,{initialize:function($super,b,d,e){$super(b,d,e);this.start=d.scrollTop;this.end=this.options.scrollTo},valueAt:function(a){return this.start+(this.end-this.start)*a},applyValue:function(a){this.object.scrollTop=a.round()}});
S2.FX.Scroll=Class.create(S2.FX.Element,{setup:function(){this.animate("scroll",this.element,{scrollTo:this.options.to})}});
S2.FX.SlideDown=Class.create(S2.FX.Element,{setup:function(){var a=this.destinationElement||this.element,b=a.getLayout();b={height:b.get("height")+"px",paddingTop:b.get("padding-top")+"px",paddingBottom:b.get("padding-bottom")+"px"};a.setStyle({height:"0",paddingTop:"0",paddingBottom:"0",overflow:"hidden"}).show();this.animate("style",a,{style:b,propertyTransitions:{}})},teardown:function(){(this.destinationElement||this.element).setStyle({height:"",paddingTop:"",paddingBottom:"",overflow:"visible"})}});
S2.FX.SlideUp=Class.create(S2.FX.Morph,{setup:function(){var a=this.destinationElement||this.element;a.getLayout();a.setStyle({overflow:"hidden"});this.animate("style",a,{style:{height:"0px",paddingTop:"0px",paddingBottom:"0px"},propertyTransitions:{}})},teardown:function(){(this.destinationElement||this.element).setStyle({height:"",paddingTop:"",paddingBottom:"",overflow:"visible"}).hide()}});
S2.FX.Transitions={linear:Prototype.K,sinusoidal:function(a){return-Math.cos(a*Math.PI)/2+0.5},reverse:function(a){return 1-a},mirror:function(a,b){b=b||S2.FX.Transitions.sinusoidal;return a<0.5?b(a*2):b(1-(a-0.5)*2)},flicker:function(a){a+=(Math.random()-0.5)/5;return S2.FX.Transitions.sinusoidal(a<0?0:a>1?1:a)},wobble:function(a){return-Math.cos(a*Math.PI*9*a)/2+0.5},pulse:function(a,b){return-Math.cos(a*((b||5)-0.5)*2*Math.PI)/2+0.5},blink:function(a,b){return Math.round(a*(b||5))%2},spring:function(a){return 1-
Math.cos(a*4.5*Math.PI)*Math.exp(-a*6)},none:Prototype.K.curry(0),full:Prototype.K.curry(1)};
(function(){function a(b,d,e,f,g,i){function h(p,q){var l,r,v,y;v=p;for(r=0;r<8;r++){y=((j*v+m)*v+u)*v-p;if((y>=0?y:0-y)<q)return v;l=(3*j*v+2*m)*v+u;if((l>=0?l:0-l)<1.0E-6)break;v-=y/l}l=0;r=1;v=p;if(v<l)return l;if(v>r)return r;for(;l<r;){y=((j*v+m)*v+u)*v;if((y-p>=0?y-p:0-(y-p))<q)return v;if(p>y)l=v;else r=v;v=(r-l)*0.5+l}return v}var j=0,m=0,u=0,w=0,n=0,o=0;u=3*d;m=3*(f-d)-u;j=1-u-m;o=3*e;n=3*(g-e)-o;w=1-o-n;return function(p,q){var l=h(p,q);return((w*l+n)*l+o)*l}(b,1/(200*i))}S2.FX.cubicBezierTransition=
function(b,d,e,f){return function(g){return a(g,b,d,e,f,1)}}})();S2.FX.Transitions.webkitCubic=S2.FX.cubicBezierTransition(0.25,0.1,0.25,1);S2.FX.Transitions.webkitEaseInOut=S2.FX.cubicBezierTransition(0.42,0,0.58,1);
Object.extend(S2.FX.Transitions,{easeInQuad:function(a){return Math.pow(a,2)},easeOutQuad:function(a){return-(Math.pow(a-1,2)-1)},easeInOutQuad:function(a){if((a/=0.5)<1)return 0.5*Math.pow(a,2);return-0.5*((a-=2)*a-2)},easeInCubic:function(a){return Math.pow(a,3)},easeOutCubic:function(a){return Math.pow(a-1,3)+1},easeInOutCubic:function(a){if((a/=0.5)<1)return 0.5*Math.pow(a,3);return 0.5*(Math.pow(a-2,3)+2)},easeInQuart:function(a){return Math.pow(a,4)},easeOutQuart:function(a){return-(Math.pow(a-
1,4)-1)},easeInOutQuart:function(a){if((a/=0.5)<1)return 0.5*Math.pow(a,4);return-0.5*((a-=2)*Math.pow(a,3)-2)},easeInQuint:function(a){return Math.pow(a,5)},easeOutQuint:function(a){return Math.pow(a-1,5)+1},easeInOutQuint:function(a){if((a/=0.5)<1)return 0.5*Math.pow(a,5);return 0.5*(Math.pow(a-2,5)+2)},easeInSine:function(a){return-Math.cos(a*(Math.PI/2))+1},easeOutSine:function(a){return Math.sin(a*(Math.PI/2))},easeInOutSine:function(a){return-0.5*(Math.cos(Math.PI*a)-1)},easeInExpo:function(a){return a==
0?0:Math.pow(2,10*(a-1))},easeOutExpo:function(a){return a==1?1:-Math.pow(2,-10*a)+1},easeInOutExpo:function(a){if(a==0)return 0;if(a==1)return 1;if((a/=0.5)<1)return 0.5*Math.pow(2,10*(a-1));return 0.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return-(Math.sqrt(1-a*a)-1)},easeOutCirc:function(a){return Math.sqrt(1-Math.pow(a-1,2))},easeInOutCirc:function(a){if((a/=0.5)<1)return-0.5*(Math.sqrt(1-a*a)-1);return 0.5*(Math.sqrt(1-(a-=2)*a)+1)},easeOutBounce:function(a){return a<1/2.75?7.5625*
a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375},easeInBack:function(a){return a*a*(2.70158*a-1.70158)},easeOutBack:function(a){return(a-=1)*a*(2.70158*a+1.70158)+1},easeInOutBack:function(a){var b=1.70158;if((a/=0.5)<1)return 0.5*a*a*(((b*=1.525)+1)*a-b);return 0.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},elastic:function(a){return-1*Math.pow(4,-8*a)*Math.sin((a*6-1)*2*Math.PI/2)+1},swingFromTo:function(a){var b=1.70158;return(a/=0.5)<
1?0.5*a*a*(((b*=1.525)+1)*a-b):0.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},swingFrom:function(a){return a*a*(2.70158*a-1.70158)},swingTo:function(a){return(a-=1)*a*(2.70158*a+1.70158)+1},bounce:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375},bouncePast:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?2-(7.5625*(a-=1.5/2.75)*a+0.75):a<2.5/2.75?2-(7.5625*(a-=2.25/2.75)*a+0.9375):2-(7.5625*(a-=2.625/2.75)*
a+0.984375)},easeFromTo:function(a){if((a/=0.5)<1)return 0.5*Math.pow(a,4);return-0.5*((a-=2)*Math.pow(a,3)-2)},easeFrom:function(a){return Math.pow(a,4)},easeTo:function(a){return Math.pow(a,0.25)}});Prototype.BrowserFeatures.WebkitCSSTransitions=false;S2.Extensions.webkitCSSTransitions=false;
(function(){try{document.createEvent("WebKitTransitionEvent")}catch(a){return}Prototype.BrowserFeatures.WebkitCSSTransitions=true;S2.Extensions.webkitCSSTransitions=true;if(Prototype.BrowserFeatures.WebkitCSSTransitions){$w("webkitBorderTopLeftRadius webkitBorderTopRightRadius webkitBorderBottomLeftRadius webkitBorderBottomRightRadius webkitBackgroundSize").each(function(b){S2.CSS.PROPERTIES.push(b)});S2.CSS.NUMERIC_PROPERTIES=S2.CSS.PROPERTIES.findAll(function(b){return!b.endsWith("olor")});S2.FX.Operators.WebkitCssTransition=
Class.create(S2.FX.Operators.Base,{initialize:function($super,d,e,f){$super(d,e,f);this.element=$(this.object);if(Object.isString(this.options.style))if(this.options.style.include(":"))this.style=$H(S2.CSS.parseStyle(this.options.style));else{this.element.addClassName(f.style);this.style=$H(this.element.getStyles());this.element.removeClassName(f.style);var g=this.element.getStyles();this.style=this.style.reject(function(i){return i.value==g[i.key]})}else this.style=$H(this.options.style);this.properties=
[];this.targetStyle="";this.style.each(function(i){var h=i[0].underscore().dasherize();i=i[1];this.element.getStyle(h);if(h.startsWith("webkit"))h="-"+h;this.properties.push(h);this.targetStyle+=";"+h+":"+i},this)},render:function(){this.element.style.webkitTransitionProperty=this.properties.join(",");this.element.style.webkitTransitionDuration=(this.effect.duration/1E3).toFixed(3)+"s";for(t in S2.FX.Operators.WebkitCssTransition.TIMING_MAP)if(S2.FX.Transitions[t]===this.effect.options.transition)this.element.style.webkitTransitionTimingFunction=
S2.FX.Operators.WebkitCssTransition.TIMING_MAP[t];this.element.setStyle(this.targetStyle);this.render=Prototype.emptyFunction}});S2.FX.Operators.WebkitCssTransition.TIMING_MAP={linear:"linear",sinusoidal:"ease-in-out"};timingFunctionForTransition=function(b){var d=null;for(t in S2.FX.Operators.WebkitCssTransition.TIMING_MAP)if(S2.FX.Transitions[t]===b)d=S2.FX.Operators.WebkitCssTransition.TIMING_MAP[t];return d};isWebkitCSSTransitionCompatible=function(b){return S2.Extensions.webkitCSSTransitions&&
(b.options.engine||"")!="javascript"&&timingFunctionForTransition(b.options.transition)&&!b.options.propertyTransitions};S2.FX.Morph=Class.create(S2.FX.Morph,{setup:function(){if(this.options.change)this.setupWrappers();else if(this.options.style){this.engine=isWebkitCSSTransitionCompatible(this)?"webkit":"javascript";this.animate(this.engine=="webkit"?"webkitCssTransition":"style",this.destinationElement||this.element,{style:this.options.style,propertyTransitions:this.options.propertyTransitions||
{}})}},render:function($super,d){if(this.engine=="webkit"){if(this.options.before)this.element.beforeStartEffect=this.options.before;if(this.options.after){this.element.afterFinishEffect=this.options.after;delete this.options.after}this.element._effect=this}return $super(d)}});Element.addMethods({morph:function(b,d,e){if(Object.isNumber(e))e={duration:e};return b.effect("morph",Object.extend(e,{style:d}))}.optionize()});S2.FX.webkitTransitionStartEvent=document.observe("webkitTransitionStart",function(b){if((b=
b.element())&&b.beforeStartEffect){b.beforeStartEffect();b.beforeStartEffect=null}});S2.FX.webkitTransitionEndEvent=document.observe("webkitTransitionEnd",function(b){var d=b.element();if(d){(function(){d.style.webkitTransitionDuration=""}).defer();if(d.afterFinishEffect){d.afterFinishEffect();d.afterFinishEffect=null}}})}})();
(function(){function a(f,g){if(Object.isElement(f)){element=f;f=element.getStyle(g)}if(f===null)return null;if(/^\d+(px)?$/i.test(f))return window.parseInt(f,10);if(/\d/.test(f)&&element.runtimeStyle){var i=element.style.left,h=element.runtimeStyle.left;element.runtimeStyle.left=element.currentStyle.left;element.style.left=f||0;f=element.style.pixelLeft;element.style.left=i;element.runtimeStyle.left=h;return f}if(f.include("%")){h=(h=f.match(/^(\d+)%?$/i))?Number(h[1])/100:null;if(g.include("left")||
g.include("right")||g.include("width"))i=$(element.parentNode).measure("width");else if(g.include("top")||g.include("bottom")||g.include("height"))i=$(element.parentNode).measure("height");return i*h}return 0}function b(f){var g=f.getLayout(),i=0,h=0;do{i+=f.offsetTop||0;h+=f.offsetLeft||0;if(f=f.offsetParent){if($w("BODY HTML").include(f.nodeName.toUpperCase()))break;if(Element.getStyle(f,"position")!=="static")break}}while(f);h-=g.get("margin-top");i-=g.get("margin-left");return new Element.Offset(h,
i)}function d(f){var g=0,i=0,h=f;do{g+=h.offsetTop||0;i+=h.offsetLeft||0;if(h.offsetParent==document.body&&Element.getStyle(h,"position")=="absolute")break}while(h=h.offsetParent);h=f;f=h.tagName;var j=Prototype.Browser.Opera;do if(!j||f&&f.toUpperCase()==="BODY"){g-=h.scrollTop||0;i-=h.scrollLeft||0}while(h=h.parentNode);return new Element.Offset(i,g)}var e=Prototype.K;if("currentStyle"in document.documentElement)e=function(f){if(!f.currentStyle.hasLayout)f.style.zoom=1;return f};Element.Layout=
Class.create(Hash,{initialize:function($super,g,i){$super();this.element=$(g);if(i){this._preComputing=true;this._begin()}Element.Layout.PROPERTIES.each(function(h){i?this._compute(h):this._set(h,null)},this);if(i){this._end();this._preComputing=false}},_set:function(f,g){return Hash.prototype.set.call(this,f,g)},set:function(){throw"Properties of Element.Layout are read-only.";},get:function($super,g){var i=$super(g);return i===null?this._compute(g):i},_begin:function(){if(!this._prepared){var f=
this.element,g;a:{for(g=f;g&&g.parentNode;){if(g.getStyle("display")==="none"){g=false;break a}g=$(g.parentNode)}g=true}if(!g){f.store("prototype_original_styles",{position:f.style.position||"",width:f.style.width||"",visibility:f.style.visibility||"",display:f.style.display||""});g=f.getStyle("position");var i=f.getStyle("width");f.setStyle({position:"absolute",visibility:"hidden",display:"block"});var h=f.getStyle("width");g=i&&h===i?window.parseInt(i,10):i&&(g==="absolute"||g==="fixed")?window.parseInt(i,
10):$(f.parentNode).getLayout().get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right");f.setStyle({width:g+"px"})}this._prepared=true}},_end:function(){var f=this.element,g=f.retrieve("prototype_original_styles");f.store("prototype_original_styles",null);f.setStyle(g);this._prepared=false},_compute:function(f){var g=Element.Layout.COMPUTATIONS;if(!(f in g))throw"Property not found.";g=g[f].call(this,
this.element);this._set(f,g);return g}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),
COMPUTATIONS:{height:function(){this._preComputing||this._begin();var f=this.get("border-box-height");if(f<=0)return 0;var g=this.get("border-top"),i=this.get("border-bottom"),h=this.get("padding-top"),j=this.get("padding-bottom");this._preComputing||this._end();return f-g-i-h-j},width:function(){this._preComputing||this._begin();var f=this.get("border-box-width");if(f<=0)return 0;var g=this.get("border-left"),i=this.get("border-right"),h=this.get("padding-left"),j=this.get("padding-right");this._preComputing||
this._end();return f-g-i-h-j},"padding-box-height":function(){var f=this.get("height"),g=this.get("padding-top"),i=this.get("padding-bottom");return f+g+i},"padding-box-width":function(){var f=this.get("width"),g=this.get("padding-left"),i=this.get("padding-right");return f+g+i},"border-box-height":function(f){return f.offsetHeight},"border-box-width":function(f){return f.offsetWidth},"margin-box-height":function(){var f=this.get("border-box-height"),g=this.get("margin-top"),i=this.get("margin-bottom");
if(f<=0)return 0;return f+g+i},"margin-box-width":function(){var f=this.get("border-box-width"),g=this.get("margin-left"),i=this.get("margin-right");if(f<=0)return 0;return f+g+i},top:function(f){return f.positionedOffset().top},bottom:function(f){var g=f.positionedOffset();f=f.getOffsetParent().measure("height");var i=this.get("border-box-height");return f-i-g.top},left:function(f){return f.positionedOffset().left},right:function(f){var g=f.positionedOffset();f=f.getOffsetParent().measure("width");
var i=this.get("border-box-width");return f-i-g.left},"padding-top":function(f){return a(f,"paddingTop")},"padding-bottom":function(f){return a(f,"paddingBottom")},"padding-left":function(f){return a(f,"paddingLeft")},"padding-right":function(f){return a(f,"paddingRight")},"border-top":function(f){return Object.isNumber(f.clientTop)?f.clientTop:a(f,"borderTopWidth")},"border-bottom":function(f){return Object.isNumber(f.clientBottom)?f.clientBottom:a(f,"borderBottomWidth")},"border-left":function(f){return Object.isNumber(f.clientLeft)?
f.clientLeft:a(f,"borderLeftWidth")},"border-right":function(f){return Object.isNumber(f.clientRight)?f.clientRight:a(f,"borderRightWidth")},"margin-top":function(f){return a(f,"marginTop")},"margin-bottom":function(f){return a(f,"marginBottom")},"margin-left":function(f){return a(f,"marginLeft")},"margin-right":function(f){return a(f,"marginRight")}}});"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(f){var g=e(f.getOffsetParent());f=f.getBoundingClientRect();
return(g.getBoundingClientRect().right-f.right).round()},bottom:function(f){var g=e(f.getOffsetParent());f=f.getBoundingClientRect();return(g.getBoundingClientRect().bottom-f.bottom).round()}});Element.Offset=Class.create({initialize:function(f,g){this.left=f.round();this.top=g.round();this[0]=this.left;this[1]=this.top},relativeTo:function(f){return new Element.Offset(this.left-f.left,this.top-f.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},
toArray:function(){return[this.left,this.top]}});Element.addMethods({getLayout:function(f){return new Element.Layout(f)},measure:function(f,g){return $(f).getLayout().get(g)},cumulativeOffset:function(f){var g=0,i=0;do{g+=f.offsetTop||0;i+=f.offsetLeft||0;f=f.offsetParent}while(f);return new Element.Offset(i,g)},positionedOffset:b,cumulativeScrollOffset:function(f){var g=0,i=0;do{g+=f.scrollTop||0;i+=f.scrollLeft||0;f=f.parentNode}while(f);return new Element.Offset(i,g)},viewportOffset:d});"getBoundingClientRect"in
document.documentElement&&Element.addMethods({viewportOffset:function(f){f=$(f);f=f.getBoundingClientRect();return new Element.Offset(f.left,f.top)},cumulativeOffset:function(f){f=$(f);var g=$(document.documentElement).viewportOffset();return f.viewportOffset().relativeTo(g)},positionedOffset:function(f){f=$(f);var g=f.getOffsetParent();if(g.nodeName.toUpperCase()==="HTML")return b(f);var i=f.viewportOffset();g=$w("BODY HTML").include(g.nodeName.toUpperCase())?d(g):g.viewportOffset();i=i.relativeTo(g);
g=f.getLayout();f=i.top-g.get("margin-top");i=i.left-g.get("margin-left");return new Element.Offset(i,f)}})})();S2.UI={};Object.deepExtend=function(a,b){for(var d in b)if(b[d]&&b[d].constructor&&b[d].constructor===Object){a[d]=a[d]||{};arguments.callee(a[d],b[d])}else a[d]=b[d];return a};S2.UI.Mixin={};
S2.UI.Mixin.Configurable={setOptions:function(a){if(!this.options){this.options={};var b=this.constructor;if(b.superclass){for(var d=[],e=b;e=e.superclass;)d.push(e);d=d.reverse();e=0;for(var f=d.length;e<f;e++)Object.deepExtend(this.options,d[e].DEFAULT_OPTIONS||{})}Object.deepExtend(this.options,b.DEFAULT_OPTIONS||{})}return Object.deepExtend(this.options,a||{})}};
S2.UI.Mixin.Trackable={register:function(){var a=this.constructor;if(!a.instances)a.instances=[];a.instances.include(this)||a.instances.push(this);Object.isFunction(a.onRegister)&&a.onRegister.call(a,this)},unregister:function(){var a=this.constructor;a.instances=a.instances.without(this);Object.isFunction(a.onRegister)&&a.onUnregister.call(a,this)}};
S2.UI.Mixin.Shim={__SHIM_TEMPLATE:new Template("<iframe frameborder='0' tabindex='-1' src='javascript:false;' style='display:block;position:absolute;z-index:-1;overflow:hidden; filter:Alpha(Opacity=\"0\");top:expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px');left:expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px');width:expression(this.parentNode.offsetWidth+'px');height:expression(this.parentNode.offsetHeight+'px');' id='#{0}'></iframe>"),createShim:function(a){if(this.__shim_isie6=
Prototype.Browser.IE&&/6.0/.test(navigator.userAgent))if(a=$(a||this.element)){this.__shimmed=a;var b=a.identify()+"_iframeshim",d=$(b);d&&d.remove();a.insert({top:this.__SHIM_TEMPLATE.evaluate([b])});this.__shim_id=b}},adjustShim:function(){if(this.__shim_isie6){var a=this.__shimmed.down("iframe#"+this.__shim_id),b=this.__shimmed;a&&a.setStyle({width:b.offsetWidth+"px",height:b.offsetHeight+"px"})}},destroyShim:function(){if(this.__shim_isie6){var a=this.__shimmed.down("iframe#"+this.__shim_id);
a&&a.remove();this.__shimmed=null}}};
Object.extend(S2.UI,{addClassNames:function(a,b){if(Object.isElement(a))a=[a];if(Object.isString(b))b=b.split(" ");for(var d,e,f=0,g;g=a[f];f++)for(d=0;e=b[d];d++)g.addClassName(e);return a},removeClassNames:function(a,b){if(Object.isElement(a))a=[a];if(Object.isString(b))b=b.split(" ");for(var d,e,f=0,g;g=a[f];f++)for(d=0;e=b[d];d++)g.removeClassName(e)},FOCUSABLE_ELEMENTS:$w("input select textarea button object"),isFocusable:function(a){var b=a.nodeName.toLowerCase(),d=a.readAttribute("tabIndex"),
e=false;e=S2.UI.FOCUSABLE_ELEMENTS.include(b)?!a.disabled:$w("a area").include(b)?a.href||d&&!isNaN(d):d&&!isNaN(d);return!!e&&S2.UI.isVisible(a)},findFocusables:function(a){return $(a).descendants().select(S2.UI.isFocusable)},isVisible:function(a){for(a=$(a);a&&a.parentNode;){var b=a.getStyle("display"),d=a.getStyle("visibility");if(b==="none"||d==="hidden")return false;a=$(a.parentNode)}return true},makeVisible:function(a,b){if(Object.isElement(a))a=[a];for(var d=0,e;e=a[d];d++)e.setStyle({visibility:b?
"visible":"hidden"});return a},modifierUsed:function(a){return a.metaKey||a.ctrlKey||a.altKey}});
(function(){function a(d){var e=Event.element(d);if(e)for(var f=0,g;g=b[f];f++)if(e===g||e.descendantOf(g)){Event.stop(d);break}}var b=[];if(document.attachEvent)document.onselectstart=a.bindAsEventListener(window);else document.observe("mousedown",a);Object.extend(S2.UI,{enableTextSelection:function(d){d.setStyle({"-moz-user-select":"","-webkit-user-select":""});b=b.without(d);return d},disableTextSelection:function(d){d.setStyle({"-moz-user-select":"none","-webkit-user-select":"none"});b.include(d)||
b.push(d);return d}})})();
S2.UI.Behavior=Class.create(S2.UI.Mixin.Configurable,{initialize:function(a,b){this.element=a;this.setOptions(b);Object.extend(this,b);this._observers={};var d,e;for(var f in this)if(f.startsWith("on")||f.include("/on")){d=f.split("/");a=d.length===2?this[d.first()]||this.element:this.element;d=d.last();e=this._observers[d]=this[f].bind(this);a.observe(d.substring(2),e)}},destroy:function(){var a=this.options.proxy||this.element,b;for(var d in this._observers){b=this._observers[d];a.stopObserving(d.substring(2),
b)}}});
Object.extend(S2.UI,{addBehavior:function(a,b,d){var e=arguments.callee;if(Object.isArray(a))a.each(function(g){e(g,b,d)});else if(Object.isArray(b))b.each(function(g){e(a,g,d)});else{var f=new b(a,d||{});$(a).retrieve("ui.behaviors",[]).push(f)}},removeBehavior:function(a,b){var d=arguments.callee;if(Object.isArray(a))a.each(function(h){d(h,b)});else if(Object.isArray(b))b.each(function(h){d(a,h)});else{for(var e=$(a).retrieve("ui.behaviors",[]),f=[],g=0,i;i=e[g];g++)if(!(!i instanceof b)){i.destroy();f.push(i)}$(a).store("ui.behaviors",
e.without(f))}},getBehavior:function(a,b){a=$(a);for(var d=a.retrieve("ui.behaviors",[]),e=0,f=d.length,g;e<f;e++){g=d[e];if(g.constructor===b)return g}return null}});
S2.UI.Behavior.Drag=Class.create(S2.UI.Behavior,{initialize:function($super,b,d){this.__onmousemove=this._onmousemove.bind(this);$super(b,d);this.element.addClassName("ui-draggable")},destroy:function($super){this.element.removeClassName("ui-draggable");$super()},"handle/onmousedown":function(a){var b=this.element;this._startPointer=a.pointer();this._startPosition={left:window.parseInt(b.getStyle("left"),10),top:window.parseInt(b.getStyle("top"),10)};document.observe("mousemove",this.__onmousemove)},
"handle/onmouseup":function(){this._startPosition=this._startPointer=null;document.stopObserving("mousemove",this.__onmousemove)},_onmousemove:function(a){a=a.pointer();if(this._startPointer){a={x:a.x-this._startPointer.x,y:a.y-this._startPointer.y};this.element.setStyle({left:this._startPosition.left+a.x+"px",top:this._startPosition.top+a.y+"px"})}}});
S2.UI.Behavior.Focus=Class.create(S2.UI.Behavior,{onfocus:function(){this.element.hasClassName("ui-state-disabled")||this.element.addClassName("ui-state-focus")},onblur:function(){this.element.hasClassName("ui-state-disabled")||this.element.removeClassName("ui-state-focus")}});
S2.UI.Behavior.Hover=Class.create(S2.UI.Behavior,{onmouseenter:function(){this.element.hasClassName("ui-state-disabled")||this.element.addClassName("ui-state-hover")},onmouseleave:function(){this.element.hasClassName("ui-state-disabled")||this.element.removeClassName("ui-state-hover")}});S2.UI.Behavior.Resize=Class.create(S2.UI.Behavior,{initialize:function(){}});
S2.UI.Behavior.Down=Class.create(S2.UI.Behavior,{onmousedown:function(){this._down=true;this.element.hasClassName("ui-state-disabled")||this.element.addClassName("ui-state-down")},onmouseup:function(){this._down=false;this.element.hasClassName("ui-state-disabled")||this.element.removeClassName("ui-state-down")},onmouseleave:function(a){return this.onmouseup(a)},onmouseenter:function(a){if(this._down)return this.onmousedown(a)}});
(function(a){a.Base=Class.create(a.Mixin.Configurable,{NAME:"S2.UI.Base",addObservers:Function.ABSTRACT,removeObservers:Function.ABSTRACT,destroy:function(){this.removeObservers()},toElement:function(){return this.element},inspect:function(){return"#<#{NAME}>".interpolate(this)}})})(S2.UI);Object.extend(Event,{KEY_SPACE:32});
(function(a){a.Accordion=Class.create(a.Base,{NAME:"S2.UI.Accordion",initialize:function(b,d){this.element=$(b);var e=this.setOptions(d);a.addClassNames(this.element,"ui-accordion ui-widget ui-helper-reset");if(this.element.nodeName.toUpperCase()==="UL"){var f=this.element.childElements().grep(new Selector("li"));a.addClassNames(f,"ui-accordion-li-fix")}this.headers=this.element.select(e.headerSelector);if(!(!this.headers||this.headers.length===0)){a.addClassNames(this.headers,"ui-accordion-header ui-helper-reset ui-state-default ui-corner-all");
a.addBehavior(this.headers,[a.Behavior.Hover,a.Behavior.Focus]);this.content=this.headers.map(function(g){return g.next()});a.addClassNames(this.content,"ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");this.headers.each(function(g){var i=new Element("span");a.addClassNames(i,"ui-icon "+e.icons.header);g.insert({top:i})});this._markActive(e.active||this.headers.first(),false);this.element.writeAttribute({role:"tablist","aria-multiselectable":e.multiple.toString()});this.headers.invoke("writeAttribute",
"role","tab");this.content.invoke("writeAttribute","role","tabpanel");this.headers.map(function(g){return g.down("a")}).invoke("observe","click",function(g){g.preventDefault()});this.observers={click:this.click.bind(this),keypress:this.keypress.bind(this)};this.addObservers()}},addObservers:function(){this.headers.invoke("observe","click",this.observers.click);Prototype.Browser.WebKit?this.headers.invoke("observe","keydown",this.observers.keypress):this.headers.invoke("observe","keypress",this.observers.keypress)},
click:function(b){(b=b.findElement(this.options.headerSelector))&&this.headers.include(b)&&this._toggleActive(b)},keypress:function(b){if(!(b.shiftKey||b.metaKey||b.altKey||b.ctrlKey)){var d=b.findElement(this.options.headerSelector);switch(b.keyCode===0?b.charCode:b.keyCode){case Event.KEY_SPACE:this._toggleActive(d);b.stop();return;case Event.KEY_DOWN:case Event.KEY_RIGHT:this._focusHeader(d,1);b.stop();return;case Event.KEY_UP:case Event.KEY_LEFT:this._focusHeader(d,-1);b.stop();return;case Event.KEY_HOME:this._focusHeader(this.headers.first());
b.stop();return;case Event.KEY_END:this._focusHeader(this.headers.last());b.stop();return}}},_focusHeader:function(b,d){if(Object.isNumber(d)){var e=this.headers.indexOf(b);e+=d;if(e>this.headers.length-1)e=this.headers.length-1;else if(e<0)e=0;b=this.headers[e]}(function(){b.down("a").focus()}).defer()},_toggleActive:function(b){if(b.hasClassName("ui-state-active")){if(this.options.multiple){this._removeActive(b);this._activatePanel(null,b.next(),true)}}else this._markActive(b)},_removeActive:function(b){var d=
this.options;a.removeClassNames(b,"ui-state-active ui-corner-top");a.addClassNames(b,"ui-state-default ui-corner-all");b.writeAttribute("aria-expanded","false");b=b.down(".ui-icon");b.removeClassName(d.icons.headerSelected);b.addClassName(d.icons.header)},_markActive:function(b,d){if(Object.isUndefined(d))d=true;var e=this.options,f=null;if(!e.multiple){f=this.element.down(".ui-accordion-content-active");this.headers.each(this._removeActive.bind(this))}if(b){a.removeClassNames(b,"ui-state-default ui-corner-all");
a.addClassNames(b,"ui-state-active ui-corner-top");b.writeAttribute("aria-expanded","true");this._activatePanel(b.next(),f,d);f=b.down(".ui-icon");f.removeClassName(e.icons.header);f.addClassName(e.icons.headerSelected);return b}},_activatePanel:function(b,d,e){if(e)this.options.transition(b,d);else{d&&d.removeClassName("ui-accordion-content-active");b&&b.addClassName("ui-accordion-content-active")}}});Object.extend(a.Accordion,{DEFAULT_OPTIONS:{multiple:false,headerSelector:"h3",icons:{header:"ui-icon-triangle-1-e",
headerSelected:"ui-icon-triangle-1-s"},transition:function(b,d){var e=[],f;if(d){f=new S2.FX.SlideUp(d,{duration:0.2,after:function(){d.removeClassName("ui-accordion-content-active")}});e.push(f)}if(b){f=new S2.FX.SlideDown(b,{duration:0.2,before:function(){b.addClassName("ui-accordion-content-active")}});e.push(f)}e.invoke("play")}}})})(S2.UI);
(function(a){a.Button=Class.create(a.Base,{NAME:"S2.UI.Button",initialize:function(b,d){this.element=$(b);this.element.store("ui.button",this);var e=this.setOptions(d);a.addClassNames(this.element,"ui-state-default ui-corner-all");a.addBehavior(this.element,[a.Behavior.Hover,a.Behavior.Focus,a.Behavior.Down]);e.primary&&this.element.addClassName("ui-priority-primary");this.element.writeAttribute("role","button");this.enabled=true;this.setEnabled(this.element.disabled===true||!this.element.hasClassName("ui-state-disabled"))},
setEnabled:function(b){if(this.enabled!==b){(this.enabled=b)?this.element.removeClassName("ui-state-disabled"):this.element.addClassName("ui-state-disabled");this.element.disabled=!b}},toElement:function(){return this.element},toHTML:function(){return this.element.toHTML()},toString:function(){return this.element.toHTML()},inspect:function(){return this.element.inspect()}});Object.extend(a.Button,{DEFAULT_OPTIONS:{primary:false}})})(S2.UI);
(function(a){a.Tabs=Class.create(a.Base,{NAME:"S2.UI.Tabs",initialize:function(b,d){this.element=$(b);a.addClassNames(this.element,"ui-widget ui-widget-content ui-tabs ui-corner-all");this.setOptions(d);var e=this.options;this.anchors=[];this.panels=[];this.list=this.element.down("ul");this.list.cleanWhitespace();this.nav=this.list;a.addClassNames(this.nav,"ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.tabs=this.list.select("li");a.addClassNames(this.tabs,"ui-state-default ui-corner-top");
a.addBehavior(this.tabs,[a.Behavior.Hover,a.Behavior.Down]);this.element.writeAttribute({role:"tablist","aria-multiselectable":"false"});this.tabs.each(function(i){var h=i.down("a");if(h){var j=h.readAttribute("href");if(j.include("#")){j=j.split("#").last();j=$(j);i.writeAttribute("tabIndex","0");if(j){j.store("ui.tab",i);i.store("ui.panel",j);this.anchors.push(h);this.panels.push(j)}}}},this);this.anchors.invoke("writeAttribute","role","tab");this.panels.invoke("writeAttribute","role","tabpanel");
this.tabs.first().addClassName("ui-position-first");this.tabs.last().addClassName("ui-position-last");a.addClassNames(this.panels,"ui-tabs-panel ui-tabs-hide ui-widget-content ui-corner-bottom");this.observers={onKeyPress:this.onKeyPress.bind(this),onTabClick:this.onTabClick.bind(this)};this.addObservers();var f=window.location.hash.substring(1),g;f.empty()||(g=$(f));this.setSelectedTab(g&&this.panels.include(g)?g.retrieve("ui.tab"):e.selectedTab?$(e.selectedTab):this.tabs.first())},addObservers:function(){this.anchors.invoke("observe",
"click",this.observers.onTabClick);this.tabs.invoke("observe","keypress",this.observers.onKeyPress)},_setSelected:function(b){b=$(b);var d=b.retrieve("ui.tab"),e=this.list.down(".ui-tabs-selected"),f=e?e.retrieve("ui.panel"):null;a.removeClassNames(this.tabs,"ui-tabs-selected ui-state-active");a.addClassNames(this.tabs,"ui-state-default");d.removeClassName("ui-state-default").addClassName("ui-tabs-selected ui-state-active");this.element.fire("ui:tabs:change",{from:{tab:e,panel:f},to:{tab:d,panel:b}});
this.options.panel.transition(f,b)},setSelectedTab:function(b){this.setSelectedPanel(b.retrieve("ui.panel"))},setSelectedPanel:function(b){this._setSelected(b.readAttribute("id"))},onTabClick:function(b){b.stop();b.findElement("a");this.setSelectedTab(b.findElement("li"))},onKeyPress:function(b){if(!a.modifierUsed(b)){var d=b.findElement("li");switch(b.keyCode||b.charCode){case Event.KEY_SPACE:case Event.KEY_RETURN:this.setSelectedTab(d);b.stop();return;case Event.KEY_UP:case Event.KEY_LEFT:this._focusTab(d,
-1);return;case Event.KEY_DOWN:case Event.KEY_RIGHT:this._focusTab(d,1);return}}},_focusTab:function(b,d){if(Object.isNumber(d)){var e=this.tabs.indexOf(b);e+=d;if(e>this.tabs.length-1)e=this.tabs.length-1;else if(e<0)e=0;b=this.tabs[e]}(function(){b.focus()}).defer()}});Object.extend(a.Tabs,{DEFAULT_OPTIONS:{panel:{transition:function(b,d){b&&b.addClassName("ui-tabs-hide");d.removeClassName("ui-tabs-hide")}}}})})(S2.UI);
(function(a){a.Overlay=Class.create(a.Base,a.Mixin.Trackable,a.Mixin.Shim,{NAME:"S2.UI.Overlay",initialize:function(b){this.setOptions(b);this.element=new Element("div",{"class":"ui-widget-overlay"});this.register();this.createShim();this.adjustShim();this.constructor.onResize()},destroy:function(){this.element.remove();this.unregister()},toElement:function(){return this.element}});Object.extend(a.Overlay,{onRegister:function(){if(this.instances.length===1){this._resizeObserver=this._resizeObserver||
this.onResize.bind(this);Event.observe(window,"resize",this._resizeObserver);Event.observe(window,"scroll",this._resizeObserver)}},onUnregister:function(){if(this.instances.length===0){Event.stopObserving(window,"resize",this._resizeObserver);Event.stopObserving(window,"scroll",this._resizeObserver)}},onResize:function(){var b=document.viewport.getDimensions(),d=document.viewport.getScrollOffsets();this.instances.each(function(e){e.element.setStyle({width:b.width+"px",height:b.height+"px",left:d.left+
"px",top:d.top+"px"})});(function(){this.instances.invoke("adjustShim")}).bind(this).defer()}})})(S2.UI);
(function(a){a.Dialog=Class.create(a.Base,{NAME:"S2.UI.Dialog",initialize:function(b,d){if(Object.isElement(b))b=$(b);else{d=b;b=null}var e=this.setOptions(d);this.element=b||new Element("div");a.addClassNames(this.element,"ui-dialog ui-widget ui-widget-content ui-corner-all");this.element.hide().setStyle({position:"absolute",overflow:"hidden",zIndex:e.zIndex,outline:"0"});this.element.writeAttribute({tabIndex:"-1",role:"dialog"});this.content=e.content?Object.isElement(e.content)?e.content:(new Element("div")).update(e.content):
new Element("div");a.addClassNames(this.content,"ui-dialog-content ui-widget-content");this.element.insert(this.content);this.titleBar=this.options.titleBar||new Element("div");a.addClassNames(this.titleBar,"ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix");this.element.insert({top:this.titleBar});this.closeButton=new Element("a",{href:"#"});a.addClassNames(this.closeButton,"ui-dialog-titlebar-close ui-corner-all");new a.Button(this.closeButton);this.closeButton.observe("mousedown",
Event.stop);this.closeButton.observe("click",function(f){f.stop();this.close(false)}.bind(this));this.titleBar.insert(this.closeButton);this.closeText=new Element("span");a.addClassNames(this.closeText,"ui-icon ui-icon-closethick");this.closeButton.insert(this.closeText);this.titleText=new Element("span",{"class":"ui-dialog-title"});this.titleText.update(this.options.title).identify();this.element.writeAttribute("aria-labelledby",this.titleText.readAttribute("id"));this.titleBar.insert({top:this.titleText});
a.disableTextSelection(this.element);this.options.draggable&&a.addBehavior(this.element,a.Behavior.Drag,{handle:this.titleBar});(e=this.options.buttons)&&e.length&&this._createButtons();this.observers={keypress:this.keypress.bind(this)}},toElement:function(){return this.element},_createButtons:function(){var b=this.options.buttons;this.buttonPane&&this.buttonPane.remove();this.buttonPane=new Element("div");a.addClassNames(this.buttonPane,"ui-dialog-buttonpane ui-widget-content ui-helper-clearfix");
b.each(function(d){var e=new Element("button",{type:"button"});a.addClassNames(e,"ui-state-default ui-corner-all");d.primary&&e.addClassName("ui-priority-primary");d.secondary&&e.addClassName("ui-priority-secondary");e.update(d.label);new a.Button(e);e.observe("click",d.action.bind(this,this));this.buttonPane.insert(e)},this);this.element.insert(this.buttonPane)},_position:function(){var b=document.viewport.getDimensions(),d=this.element;d={width:parseInt(d.getStyle("width"),10),height:parseInt(d.getStyle("height"),
10)};b={left:(b.width/2-d.width/2).round(),top:(b.height/2-d.height/2).round()};d=document.viewport.getScrollOffsets();b.left+=d.left;b.top+=d.top;this.element.setStyle({left:b.left+"px",top:b.top+"px"})},open:function(){if(!this._isOpen)if(!this.element.fire("ui:dialog:before:open",{dialog:this}).stopped){var b=this.options;this.overlay=b.modal?new a.Overlay:null;$(document.body).insert(this.overlay);$(document.body).insert(this.element);this.element.show();this._position();this.focusables=a.findFocusables(this.element);
b.submitForms||this.content.select("form").invoke("observe","submit",Event.stop);var d=this.focusables.without(this.closeButton),e=b.focus;b=false;if(e==="first"){d.first().focus();b=true}else if(e==="last"){d.last().focus();b=true}else if(Object.isElement(e)){e.focus();b=true}else if(this.buttonPane)if(e=this.buttonPane.down(".ui-priority-primary")){e.focus();b=true}!b&&d.length>0&&d.first().focus();Event.observe(window,"keydown",this.observers.keypress);this._isOpen=true;this.element.fire("ui:dialog:after:open",
{dialog:this});return this}},close:function(b){b=!!b;if(!this.element.fire("ui:dialog:before:close",{dialog:this}).stopped){this.overlay&&this.overlay.destroy();this.element.hide();this._isOpen=false;Event.stopObserving(window,"keydown",this.observers.keypress);b={dialog:this,success:b};var d=this.content.down("form");d&&Object.extend(b,{form:d.serialize({hash:true})});this.element.fire("ui:dialog:after:close",b);a.enableTextSelection(this.element,true);return this}},keypress:function(b){if(!a.modifierUsed(b)){var d=
this.focusables,e=this.options;if(b.keyCode===Event.KEY_ESC)e.closeOnEscape&&this.close(false);else if(b.keyCode===Event.KEY_RETURN)this.close(true);else if(b.keyCode===Event.KEY_TAB)if(this.options.modal)if(d){var f;e=b.findElement();e=d.indexOf(e);if(f=e===-1?d.first():b.shiftKey?e===0?d.last():d[e-1]:e===d.length-1?d.first():d[e+1]){b.stop();(function(){f.focus()}).defer()}}}}});Object.extend(a.Dialog,{DEFAULT_OPTIONS:{zIndex:1E3,title:"Dialog",content:null,modal:true,focus:"auto",submitForms:false,
closeOnEscape:true,draggable:true,resizable:false,buttons:[{label:"OK",primary:true,action:function(b){b.close(true)}}]}})})(S2.UI);
(function(a){a.Slider=Class.create(a.Base,{NAME:"S2.UI.Slider",initialize:function(b,d){this.element=$(b);var e=this.setOptions(d);a.addClassNames(this.element,"ui-slider ui-widget ui-widget-content ui-corner-all");this.orientation=e.orientation;this.element.addClassName("ui-slider-"+this.orientation);this._computeTrackLength();var f=e.value.initial;Object.isArray(f)||(f=[f]);this.values=f;this.handles=[];this.values.each(function(i,h){var j=new Element("a",{href:"#"});j.store("ui.slider.handle",
h);this.handles.push(j);this.element.insert(j)},this);a.addClassNames(this.handles,"ui-slider-handle ui-state-default ui-corner-all");this.handles.invoke("writeAttribute","tabIndex","0");this.activeHandle=this.handles.first();this.handles.invoke("observe","click",Event.stop);a.addBehavior(this.handles,[a.Behavior.Hover,a.Behavior.Focus]);this.observers={focus:this.focus.bind(this),blur:this.blur.bind(this),keydown:this.keydown.bind(this),keyup:this.keyup.bind(this),mousedown:this.mousedown.bind(this),
mouseup:this.mouseup.bind(this),mousemove:this.mousemove.bind(this),rangeMouseDown:this.rangeMouseDown.bind(this),rangeMouseMove:this.rangeMouseMove.bind(this),rangeMouseUp:this.rangeMouseUp.bind(this)};f=e.value;if(f.step!==null){this._possibleValues=[];for(var g=f.min;g<f.max;g+=f.step)this._possibleValues.push(g);this._possibleValues.push(f.max);this.keyboardStep=f.step}else if(e.possibleValues){this._possibleValues=e.possibleValues.clone();this.keyboardStep=null}else this.keyboardStep=(f.max-
f.min)/100;this.range=null;if(e.range&&this.values.length===2){this.restricted=true;this.range=new Element("div",{"class":"ui-slider-range"});this.element.insert(this.range);this.range.addClassName("ui-widget-header")}this._computeTrackLength();this._computeHandleLength();this.disabled=this.dragging=this.active=false;this.addObservers();this.values.each(this.setValue,this);this.initialized=true},addObservers:function(){this.element.observe("mousedown",this.observers.mousedown);this.range&&this.range.observe("mousedown",
this.observers.rangeMouseDown);this.handles.invoke("observe","keydown",this.observers.keydown);this.handles.invoke("observe","keyup",this.observers.keyup)},_computeTrackLength:function(){var b;if(this.orientation==="vertical"){b=this.element.offsetHeight;b=b!==0?b:window.parseInt(this.element.getStyle("height"),10)}else{b=this.element.offsetWidth;b=b!==0?b:window.parseInt(this.element.getStyle("width"),10)}return this._trackLength=b},_computeHandleLength:function(){var b=this.handles.first(),d;if(b){if(this.orientation===
"vertical"){d=b.offsetHeight;b=d!==0?d:window.parseInt(b.getStyle("height"),10)}else{d=b.offsetWidth;b=d!==0?d:window.parseInt(b.getStyle("width"),10)}return this._handleLength=b}},_nextValue:function(b,d){return this.options.possibleValues?this._possibleValues[this._possibleValues.indexOf(b)+d]:b+this.keyboardStep*d},keydown:function(b){if(!this.options.disabled){var d=b.findElement(),e=d.retrieve("ui.slider.handle"),f=this.options;if(Object.isNumber(e))if([Event.KEY_HOME,Event.KEY_END,Event.KEY_UP,
Event.KEY_DOWN,Event.KEY_LEFT,Event.KEY_RIGHT].include(b.keyCode)){d.addClassName("ui-state-active");var g;d=g=this.values[e];switch(b.keyCode){case Event.KEY_HOME:g=f.value.min;break;case Event.KEY_END:g=f.value.max;break;case Event.KEY_UP:case Event.KEY_RIGHT:if(d===f.value.max)return;g=this._nextValue(d,1);break;case Event.KEY_DOWN:case Event.KEY_LEFT:if(d===f.value.min)return;g=this._nextValue(d,-1);break}this.dragging=true;this.setValue(g,e);if(!Prototype.Browser.WebKit){e=this._timer?0.1:1;
this._timer=arguments.callee.bind(this).delay(e,b)}}}},keyup:function(b){this.dragging=false;if(this._timer){window.clearTimeout(this._timer);this._timer=null}this._updateFinished();b.findElement().removeClassName("ui-state-active")},setValue:function(b,d){if(!this.activeHandle){this.activeHandle=this.handles[d||0];this._updateStyles()}d=d||this.activeHandle.retrieve("ui.slider.handle")||0;if(this.initialized&&this.restricted){if(d>0&&b<this.values[d-1])b=this.values[d-1];if(d<this.handles.length-
1&&b>this.values[d+1])b=this.values[d+1]}b=this._getNearestValue(b);this.values[d]=b;var e={};e[this.orientation==="vertical"?"top":"left"]=this._valueToPx(b)+"px";this.handles[d].setStyle(e);this._drawRange();!this.dragging&&!this.undoing&&!this.initialized&&this._updateFinished();if(this.initialized){this.element.fire("ui:slider:value:changing",{slider:this,values:this.values});this.options.onSlide(this.values,this)}return this},_getNearestValue:function(b){var d=this.options.value;if(b<d.min)b=
d.min;if(b>d.max)b=d.max;if(this._possibleValues){var e;for(d=0;d<this._possibleValues.length;d++){e=this._possibleValues[d];if(e===b)return b;if(e>b)break}b=b.nearer(this._possibleValues[d-1],e)}return b},_valueToPx:function(b){var d=this.options.value,e=(this._trackLength-this._handleLength/2)/(d.max-d.min);e*=b-d.min;if(this.orientation==="vertical")e=this._trackLength-e-this._handleLength;return Math.round(e)},mousedown:function(b){var d=this.options;if(!(!b.isLeftClick()||d.disabled)){b.stop();
this._oldValues=this.values.clone();this.active=true;var e=b.findElement();d=b.pointer();if(e===this.element){b=this.element.cumulativeOffset();this.setValue(this._pxToValue({x:Math.round(d.x-b.left+this._handleLength/4),y:Math.round(d.y-b.top+this._handleLength/4)}));handle=this.activeHandle=this.activeHandle||this.handles.first()}else{handle=b.findElement(".ui-slider-handle");if(!handle)return;this.activeHandle=handle}this._updateStyles();b=handle.cumulativeOffset();this._offsets={x:d.x-b.left,
y:d.y-b.top};document.observe("mousemove",this.observers.mousemove);document.observe("mouseup",this.observers.mouseup)}},mouseup:function(b){if(this.active&&this.dragging){this._updateFinished();b.stop()}this.active=this.dragging=false;this.activeHandle=null;this._updateStyles();document.stopObserving("mousemove",this.observers.mousemove);document.stopObserving("mouseup",this.observers.mouseup)},mousemove:function(b){if(this.active){b.stop();this.dragging=true;this._draw(b);Prototype.Browser.WebKit&&
window.scrollBy(0,0)}},rangeMouseDown:function(b){b=b.pointer();var d=this.element.cumulativeOffset();b={x:Math.round(b.x-d.left),y:Math.round(b.y-d.top)};this._rangeInitialValues=this.values.clone();this._rangePseudoValue=this._pxToValue(b);document.observe("mousemove",this.observers.rangeMouseMove);document.observe("mouseup",this.observers.rangeMouseUp)},rangeMouseMove:function(b){this.dragging=true;b.stop();var d=this.options;b=b.pointer();var e=this.element.cumulativeOffset(),f=this._pxToValue({x:Math.round(b.x-
e.left),y:Math.round(b.y-e.top)})-this._rangePseudoValue;b=this._rangeInitialValues.map(function(g){return g+f});if(b[0]<d.value.min){f=d.value.min-this._rangeInitialValues[0];b=this._rangeInitialValues.map(function(g){return g+f})}else if(b[1]>d.value.max){f=d.value.max-this._rangeInitialValues[1];b=this._rangeInitialValues.map(function(g){return g+f})}b.each(this.setValue,this)},rangeMouseUp:function(){this.dragging=false;document.stopObserving("mousemove",this.observers.rangeMouseMove);document.stopObserving("mouseup",
this.observers.rangeMouseUp);this._updateFinished()},_draw:function(b){b=b.pointer();var d=this.element.cumulativeOffset();b.x-=this._offsets.x+d.left;b.y-=this._offsets.y+d.top;this.setValue(this._pxToValue(b))},_pxToValue:function(b){var d=this.options;b=(this.orientation==="horizontal"?b.x:b.y)/(this._trackLength-this._handleLength)*(d.value.max-d.value.min)+d.value.min;if(this.orientation==="vertical")b=d.value.max-(b-d.value.min);return b},undo:function(){if(this._oldValues){this.values=this._oldValues.clone();
this.undoing=true;this._oldValues.each(this.setValue,this);this.undoing=false}},_updateFinished:function(){if(this.element.fire("ui:slider:value:changed",{slider:this,values:this.values}).stopped)this.undo();else{this.activeHandle=null;this._updateStyles();this.options.onChange(this.values,this)}},_updateStyles:function(){a.removeClassNames(this.handles,"ui-state-active");this.activeHandle&&this.activeHandle.addClassName("ui-state-active")},_drawRange:function(){if(this.range){var b=this.values.map(this._valueToPx,
this);this.orientation==="vertical"?this.range.setStyle({top:b[1]+"px",height:b[0]-b[1]+"px"}):this.range.setStyle({left:b[0]+"px",width:b[1]-b[0]+"px"})}},focus:function(b){if(!this.options.disabled){b=b.findElement();this.element.select(".ui-state-focus").invoke("removeClassName","ui-state-focus");b.addClassName("ui-state-focus")}},blur:function(b){b.findElement().removeClassName("ui-state-focus")}});Object.extend(a.Slider,{DEFAULT_OPTIONS:{range:false,disabled:false,value:{min:0,max:100,initial:0,
step:null},possibleValues:null,orientation:"horizontal",onSlide:Prototype.emptyFunction,onChange:Prototype.emptyFunction}})})(S2.UI);
(function(a){a.ProgressBar=Class.create(a.Base,{NAME:"S2.UI.ProgressBar",initialize:function(b,d){this.element=$(b);var e=this.setOptions(d);a.addClassNames(this.element,"ui-progressbar ui-widget ui-widget-content ui-corner-all");this.element.writeAttribute({role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0});this.valueElement=new Element("div",{"class":"ui-progressbar-value ui-widget-header ui-corner-left"});this.value=e.value.initial;this._refreshValue();this.element.insert(this.valueElement);
this.element.store(this.NAME,this)},destroy:function(){a.removeClassNames(this.element,"ui-progressbar ui-widget ui-widget-content ui-corner-all");a.removeAttributes(this.element,"role aria-valuemin aria-valuemax aria-valuenow");this.element.getData().unset(this.NAME)},getValue:function(){var b=this.value,d=this.options.value;if(b<d.min)b=d.min;if(b>d.max)b=d.max;return b},setValue:function(b){this._oldValue=this.getValue();this.value=b;this._refreshValue();return this},undo:function(){this.undoing=
true;this.setValue(this._oldValue);this.undoing=false;return this},_refreshValue:function(){var b=this.getValue();if(!this.undoing)if(this.element.fire("ui:progressbar:value:changed",{progressBar:this,value:b}).stopped){this.undo();return}b===this.options.value.max?this.valueElement.addClassName("ui-corner-right"):this.valueElement.removeClassName("ui-corner-right");var d="width: #{0}px".interpolate([window.parseInt(this.element.getStyle("width"),10)*b/100]);a.makeVisible(this.valueElement,b>this.options.value.min);
this.valueElement.morph(d,{duration:0.7,transition:"linear"});this.element.writeAttribute("aria-valuenow",b)}});Object.extend(a.ProgressBar,{DEFAULT_OPTIONS:{value:{min:0,max:100,initial:0}}})})(S2.UI);
(function(a){a.Menu=Class.create(a.Base,a.Mixin.Shim,{NAME:"S2.UI.Menu",initialize:function(b){this.element=$(b);if(!this.element)this.element=new Element("ul",{"class":"ui-helper-hidden"});this.activeId=this.element.identify()+"_active";b=this.setOptions();a.addClassNames(this.element,"ui-widget ui-widget-content ui-menu ui-corner-"+b.corner);this.choices=this.element.select("li");this._highlightedIndex=-1;this.element.writeAttribute({role:"menu","aria-activedescendant":this.activeId});this.choices.invoke("writeAttribute",
"role","menuitem");this.observers={mouseover:this._mouseover.bind(this),click:this._click.bind(this)};this.addObservers();this._shown=false;this.createShim()},addObservers:function(){this.element.observe("mouseover",this.observers.mouseover);this.element.observe("mousedown",this.observers.click)},removeObservers:function(){this.element.stopObserving("mouseover",this.observers.mouseover);this.element.stopObserving("mousedown",this.observers.click)},clear:function(){this.element.select("li").invoke("remove");
this.choices=[];return this},addChoice:function(b){var d;if(Object.isElement(b))if(b.tagName.toUpperCase()==="LI")d=b;else{d=new Element("li");d.insert(b)}else{d=new Element("li");d.update(b)}d.addClassName("ui-menu-item");d.writeAttribute("role","menuitem");this.element.insert(d);this.choices=this.element.select("li");return d},_mouseover:function(b){(b=b.findElement("li"))&&this.highlightChoice(b)},_click:function(b){(b=b.findElement("li"))&&this.selectChoice(b)},moveHighlight:function(b){this._highlightedIndex=
(this._highlightedIndex+b).constrain(-1,this.choices.length-1);this.highlightChoice();return this},highlightChoice:function(b){var d=this.choices;b=Object.isElement(b)?d.indexOf(b):Object.isNumber(b)?b:this._highlightedIndex;a.removeClassNames(this.choices,"ui-state-active");if(b!==-1){this.choices[b].addClassName("ui-state-active");this._highlightedIndex=b;(d=this.element.down("#"+this.activeId))&&d.writeAttribute("id","");this.choices[b].writeAttribute("id",this.activeId)}},selectChoice:function(b){if(Object.isNumber(b))b=
this.choices[b];else b||(b=this.choices[this._highlightedIndex]);this.element.fire("ui:menu:selected",{instance:this,element:b}).stopped||this.close();return this},open:function(){this.element.fire("ui:menu:opened",{instance:this});this.element.removeClassName("ui-helper-hidden");this._highlightedIndex=-1;Prototype.Browser.IE&&this.adjustShim()},close:function(){this.element.fire("ui:menu:closed",{instance:this});this.element.addClassName("ui-helper-hidden");return this},isOpen:function(){return!this.element.hasClassName("ui-helper-hidden")}});
Object.extend(a.Menu,{DEFAULT_OPTIONS:{corner:"all"}})})(S2.UI);
(function(a){a.Autocompleter=Class.create(a.Base,{NAME:"S2.UI.Autocompleter",initialize:function(b,d){this.element=$(b);var e=this.setOptions(d);a.addClassNames(this.element,"ui-widget ui-autocompleter");this.input=this.element.down('input[type="text"]');if(!this.input){this.input=new Element("input",{type:"text"});this.element.insert(this.input)}this.input.insert({before:this.button});this.input.setAttribute("autocomplete","off");this.name=e.parameterName||this.input.readAttribute("name");if(e.choices)this.choices=
e.choices.clone();this.menu=new a.Menu;this.element.insert(this.menu.element);(function(){var f=this.input.getLayout();this.menu.element.setStyle({left:f.get("left")+"px",top:f.get("top")+f.get("margin-box-height")+"px"})}).bind(this).defer();this.observers={blur:this._blur.bind(this),keyup:this._keyup.bind(this),keydown:this._keydown.bind(this),selected:this._selected.bind(this)};this.addObservers()},addObservers:function(){this.input.observe("blur",this.observers.blur);this.input.observe("keyup",
this.observers.keyup);this.input.observe("keydown",this.observers.keydown);this.menu.element.observe("ui:menu:selected",this.observers.selected)},_schedule:function(){this._unschedule();this._timeout=this._change.bind(this).delay(this.options.frequency)},_unschedule:function(){this._timeout&&window.clearTimeout(this._timeout)},_keyup:function(){var b=this.input.getValue();if(b){if(b.blank()||b.length<this.options.minCharacters){this.menu.close();this._unschedule();return}b!==this._value&&this._schedule()}else{this.menu.close();
this._unschedule()}this._value=b},_keydown:function(b){if(!a.modifierUsed(b))if(this.menu.isOpen())switch(b.keyCode){case Event.KEY_UP:this.menu.moveHighlight(-1);b.stop();break;case Event.KEY_DOWN:this.menu.moveHighlight(1);b.stop();break;case Event.KEY_TAB:this.menu.selectChoice();break;case Event.KEY_RETURN:this.menu.selectChoice();this.input.blur();b.stop();break;case Event.KEY_ESC:this.input.setValue("");this.input.blur();break}},_getInput:function(){return this.input.getValue()},_setInput:function(b){this.input.setValue(b)},
_change:function(){this.findChoices()},findChoices:function(){var b=this._getInput();this.setChoices((this.choices||[]).inject([],function(d,e){e.toLowerCase().include(b.toLowerCase())&&d.push(e);return d}))},setChoices:function(b){this.results=b;this._updateMenu(b)},_updateMenu:function(b){var d=this.options;this.menu.clear();for(var e=new RegExp(RegExp.escape(this._value),"i"),f=0,g,i,h;g=b[f];f++){h=d.highlightSubstring?g.replace(e,"<b>$&</b>"):h;i=(new Element("li")).update(h);i.store("ui.autocompleter.value",
g);this.menu.addChoice(i)}b.length===0?this.menu.close():this.menu.open()},_moveMenuChoice:function(b){this.list.down("li");this._selectedIndex=(this._selectedIndex+b).constrain(-1,this.results.length-1);this._highlightMenuChoice()},_highlightMenuChoice:function(b){var d=this.list.select("li");b=Object.isElement(b)?d.indexOf(b):Object.isNumber(b)?b:this._selectedIndex;a.removeClassNames(d,"ui-state-active");if(!(b===-1||b===null)){d[b].addClassName("ui-state-active");this._selectedIndex=b}},_selected:function(b){(b=
b.memo.element)&&this._setInput(b.retrieve("ui.autocompleter.value"));this.menu.close()},_blur:function(){this._unschedule();this.menu.close()}});Object.extend(a.Autocompleter,{DEFAULT_OPTIONS:{tokens:[],frequency:0.4,minCharacters:1,highlightSubstring:true,onShow:Prototype.K,onHide:Prototype.K}})})(S2.UI);
document.observe("dom:loaded",function(){function a(j){j._rotation=j._rotation||0;j._scale=j._scale||1;j._panX=j._panX||0;j._panY=j._panY||0;j._pans=[[0,0],[0,0],[0,0]];j._panidx=1}function b(j,m){j.fire("manipulate:update",Object.extend(m,{id:g}))}function d(){function j(x){for(var A=x.length;A--;)n[x[A].identifier]=x[A];x=[];for(k in n)x.push(k);x=x.sort();if((m=(o=x.length>0?x[0]:null)?n[o].target:null)&&m.nodeType==3)m=m.parentNode;p=x.length>1?x[1]:null;if(q==0&&o&&p){v=(n[o].pageX-n[p].pageX).abs();
y=(n[o].pageY-n[p].pageY).abs();m&&a(m);z=Math.sqrt(v*v+y*y);B=Math.atan2(n[p].pageY-n[o].pageY,n[p].pageX-n[o].pageX);q=1}else if(q==1&&!(o&&p)){if(m){x=m;A=w;x._rotation=u;x._scale=A;x._panX=void 0;x._panY=void 0}q=0}}var m,u,w,n={},o=null,p=null,q=0,l,r,v,y,z,B;f.observe("touchstart",function(x){var A=o;j(x.changedTouches);if(A==null&&o){A=m.viewportOffset();l=A.left+(n[o].pageX-A.left);r=A.top+(n[o].pageY-A.top)}x.stop()});f.observe("touchmove",function(x){j(x.changedTouches);if(o&&!p){b(m,{panX:(m._panX||
0)+n[o].pageX-l,panY:(m._panY||0)+n[o].pageY-r,scale:m._scale,rotation:m._rotation});x.stop()}else if(o&&p){var A=n[p].pageX-n[o].pageX,C=n[p].pageY-n[o].pageY,D=(m._panX||0)+n[p].pageX-A/2-l,E=(m._panY||0)+n[p].pageY-C/2-r;w=m._scale*Math.sqrt(A*A+C*C)/z;u=m._rotation+Math.atan2(C,A)-B;b(m,{rotation:u,scale:w,panX:D,panY:E});x.stop()}});["touchcancel","touchend"].each(function(x){f.observe(x,function(A){for(var C=A.changedTouches.length;C--;)delete n[A.changedTouches[C].identifier];j([]);if(m){A=
m;C=w;A._rotation=u;A._scale=C;A._panX=void 0;A._panY=void 0}})})}function e(){var j,m,u,w,n,o=false;f.observe("manipulatestart",function(p){p.stop();j=p.element();a(j);o=true});f.observe("manipulatemove",function(p){j=p.element();m=j._rotation+p.rotation;u=j._scale*p.scale;w=j._panX+p.panX;n=j._panY+p.panY;b(j,{rotation:m,scale:u,panX:w,panY:n,clientX:p.clientX,clientY:p.clientY});p.stop()},false);f.observe("manipulateend",function(p){if(j=p.element()){var q=j,l=u,r=w,v=n;q._rotation=m;q._scale=
l;q._panX=r;q._panY=v}o=false;q=Math.sqrt(p.panSpeedX*p.panSpeedX+p.panSpeedY*p.panSpeedY);q>25&&j.fire("manipulate:flick",{speed:q,direction:Math.atan2(p.panSpeedY,p.panSpeedX)})});f.observe("mousemove",function(p){p.stop()});f.observe("mousedown",function(p){p.stop()});f.observe("mouseup",function(p){p.stop()})}if(S2.enableMultitouchSupport){var f=$(document.body),g=0;if(navigator.userAgent.match(/SLBrowser/))return e();if(navigator.userAgent.match(/QtLauncher/))return e();if(navigator.userAgent.match(/Starlight/))return e();
try{document.createEvent("ManipulateEvent");return e()}catch(i){}try{document.createEvent("TouchEvent");return d()}catch(h){}return function(){function j(x){var A=o.viewportOffset(),C=x.pageX-A.left-u;x=x.pageY-A.top-w;B=Math.sqrt(C*C+x*x);z=o._scale*B/q;y=o._rotation+Math.atan2(x,C)-l;return{rotation:y,scale:z,panX:o._panX,panY:o._panY}}function m(x){return{rotation:o._rotation,scale:o._scale,panX:o._panX+x.pageX-r,panY:o._panY+x.pageY-v}}var u,w,n=false,o,p,q,l,r,v,y,z,B;f.observe("mousedown",function(x){p=
x.shiftKey?"scale":"pan";if((o=x.element())&&o.fire){g++;n=true;a(o);var A=o.viewportOffset();u=o.offsetWidth/2;w=o.offsetHeight/2;var C=x.pageX-A.left-u,D=x.pageY-A.top-w;q=Math.sqrt(C*C+D*D);l=Math.atan2(D,C);r=A.left+(x.pageX-A.left);v=A.top+(x.pageY-A.top);x.stop()}});f.observe("mousemove",function(x){if(n)b(o,p=="scale"?j(x):m(x))});f.observe("mouseup",function(x){if(n){n=false;if(p=="scale"){x=j(x);b(o,x);o._rotation=x.rotation;o._scale=x.scale}else{b(o,m(x));o._panX=o._panX+x.pageX-r;o._panY=
o._panY+x.pageY-v}}});f.observe("dragstart",function(x){x.stop()})}()}});Element.__scrollTo=Element.scrollTo;Element.addMethods({scrollTo:function(a,b,d){if(arguments.length==1)return Element.__scrollTo(a);(new S2.FX.Scroll(a,Object.extend(d||{},{to:b}))).play();return a}});
Element.addMethods({effect:function(a,b,d){if(Object.isFunction(b))b=new b(a,d);else if(Object.isString(b))b=new (S2.FX[b.capitalize()])(a,d);b.play(a,d);return a},morph:function(a,b,d){d=S2.FX.parseOptions(d);if(!d.queue){d.queue=a.retrieve("S2.FX.Queue");if(!d.queue)a.store("S2.FX.Queue",d.queue=new S2.FX.Queue)}if(!d.position)d.position="end";return a.effect("morph",Object.extend(d,{style:b}))}.optionize(),appear:function(a,b){return a.effect("morph",Object.extend({before:function(){a.show().setStyle({opacity:0})},
style:"opacity:1"},b))},fade:function(a,b){return a.effect("morph",Object.extend({style:"opacity:0",after:a.hide.bind(a)},b))},cloneWithoutIDs:function(a){a=$(a);a=a.cloneNode(true);a.id="";$(a).select("*[id]").each(function(b){b.id=""});return a}});
(function(){Element.addMethods({transform:window.CSSMatrix?function(a,b){a.style.transform="scale("+(b.scale||1)+") rotate("+(b.rotation||0)+"rad)";return a}:window.WebKitCSSMatrix?function(a,b){a.style.webkitTransform="scale("+(b.scale||1)+") rotate("+(b.rotation||0)+"rad)";return a}:Prototype.Browser.Gecko?function(a,b){a.style.MozTransform="scale("+(b.scale||1)+") rotate("+(b.rotation||0)+"rad)";return a}:Prototype.Browser.IE?function(a,b){if(!a._oDims)a._oDims=[a.offsetWidth,a.offsetHeight];var d=
Math.cos(b.rotation||0)*1,e=Math.sin(b.rotation||0)*1;a.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand',M11="+d+",M12="+-e+",M21="+e+",M22="+d+")";a.style.marginLeft=(a._oDims[0]-a.offsetWidth)/2+"px";a.style.marginTop=(a._oDims[1]-a.offsetHeight)/2+"px";return a}:function(a){return a}})})();
S2.viewportOverlay=function(){var a=document.viewport.getDimensions(),b=document.viewport.getScrollOffsets();return(new Element("div")).setStyle({position:"absolute",left:b.left+"px",top:b.top+"px",width:a.width+"px",height:a.height+"px"})};S2.FX.Helpers={fitIntoRectangle:function(a,b,d,e){return a/b<d/e?[(d-a*(e/b))/2,0,a*(e/b),e]:[0,(e-b*(d/a))/2,d,b*(d/a)]}};
S2.FX.Operators.Zoom=Class.create(S2.FX.Operators.Style,{initialize:function($super,b,d,e){var f=document.viewport.getDimensions(),g=document.viewport.getScrollOffsets(),i=d.getDimensions();f=S2.FX.Helpers.fitIntoRectangle(i.width,i.height,f.width-(e.borderWidth||0)*2,f.height-(e.borderWidth||0)*2);Object.extend(e,{style:{left:f[0]+(e.borderWidth||0)+g.left+"px",top:f[1]+(e.borderWidth||0)+g.top+"px",width:f[2]+"px",height:f[3]+"px"}});$super(b,d,e)}});
S2.FX.Zoom=Class.create(S2.FX.Element,{setup:function(){this.clone=this.element.cloneWithoutIDs();this.element.insert({before:this.clone});this.clone.absolutize().setStyle({zIndex:9999});this.overlay=S2.viewportOverlay();this.options.overlayClassName?this.overlay.addClassName(this.options.overlayClassName):this.overlay.setStyle({backgroundColor:"#000",opacity:"0.9"});$$("body")[0].insert(this.overlay);this.animate("zoom",this.clone,{borderWidth:this.options.borderWidth,propertyTransitions:this.options.propertyTransitions||
{}})},teardown:function(){this.clone.observe("click",function(){this.overlay.remove();this.clone.morph("opacity:0",{duration:0.2,after:function(){this.clone.remove()}.bind(this)})}.bind(this))}});var anakata_timersNumber=1,anakata_c2d,anakata_busy=false,anakata_killMode=false,anakata_widgetsOpen=[],anakata_midgets=[],anakata_defaultDuration=0.75,anakata_isInfoDisplaying=false,anakata_isHotkeysEnabled=true,anakata_drawTimer=[],anakata_fpsTimer,anakata_xya=0,anakata_xza=0,anakata_xwa=0,anakata_yza=0,anakata_ywa=0,anakata_zwa=0,anakata_projectedVertices=[],anakata_frames=0,anakata_xClipMin=0,anakata_xClipMax=0,anakata_yClipMin=0,anakata_yClipMax=0,anakata_isloadBox=false,anakata_isMenu=false,
anakata_isBox=new Hash,anakata_infoQueue=[],anakata_o={},anakata_fullScreenTextarea,anakata_xhrDone=true,anakata_isInError=false;anakata_isBox.set("loginBox",false);anakata_isBox.set("creditsBox",false);anakata_isBox.set("loadBox",false);anakata_isBox.set("loadOnlineBox",false);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-5078036-13"]);_gaq.push(["_trackPageview"]);
(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();function s(a){return Math.sin(a)}function c(a){return Math.cos(a)};function anakata_makeLoadDiv(){var a='<div id="loadBox"><div id="meshList">';if(localStorage.length==0){a+='<div class="mesh"><div class="meshName">';a+="There's nothing to load ! <br /> <br /> <span style='padding-left: 2em;'> Save something first ! </span><br /> ";a+="</div>";a+="</div>"}else for(var b=0;b<localStorage.length;b++){var d=new anakata_Settings(localStorage.getItem(localStorage.key(b)),false);a+='<div id="mesh'+b+'" class="mesh"><div class="meshNameDescription"><div id="name'+b+'"class="meshName">';
a+=d.name;a+='</div><div class="meshDescription">'+d.description;a+='</div></div><div id="del'+b+'" class="meshDel" >x</div>';a+="</div>"}a+="</div></div>";$("loadDiv").innerHTML=a;$("meshList").addEventListener("click",function(e){e.stopPropagation()},false);for(b=0;b<localStorage.length;b++){$("name"+b).index=b;$("name"+b).addEventListener("click",function(){anakata_load(this.index);anakata_unloadDiv("loadBox")},false);$("del"+b).index=b;$("del"+b).addEventListener("click",function(){anakata_del(this.index)},
false)}}
function anakata_makeLoadOnlineDiv(a){var b='<div id="loadOnlineBox"><div id="onlineMeshList">';if(a.length==0){b+='<div class="mesh"><div class="meshName">';b+="There's nothing online ?! Strange...";b+="</div>";b+="</div>"}else for(var d=0;d<a.length;d++){b+='<div id="omesh'+d+'" class="mesh">';b+='<div id="scoring">';b+='<div id="up'+d+'" class="meshUp" >\u2227</div>';b+='<div id="score'+d+'" class="meshScore">'+a[d].score+"</div>";b+='<div id="down'+d+'" class="meshDown" >\u2228</div>';b+="</div>";
b+='<div class="meshNameDescription"><div id="oname'+d+'"class="meshName">';b+=a[d].meshname+" by "+a[d].username;b+="</div>";if(a[d].mesh.description)b+='<div class="meshDescription">'+a[d].mesh.description+"</div></div>";if(sessionStorage.getItem("login")==a[d].username)b+='<div id="odel'+d+'" class="meshDel" >x</div>';b+="</div>"}b+="</div></div>";$("loadOnlineDiv").innerHTML=b;$("onlineMeshList").addEventListener("click",function(e){e.stopPropagation()},false);for(d=0;d<a.length;d++){$("oname"+
d).name=a[d].meshname;$("oname"+d).addEventListener("click",function(){anakata_loadMesh(this.name);anakata_unloadDiv("loadOnlineBox")},false);$("up"+d).index=d;$("up"+d).name=a[d].meshname;$("up"+d).addEventListener("click",function(){anakata_vote(this.name,true,this.index)},false);$("down"+d).index=d;$("down"+d).name=a[d].meshname;$("down"+d).addEventListener("click",function(){anakata_vote(this.name,false,this.index)},false);if(sessionStorage.getItem("login")==a[d].username){$("odel"+d).name=a[d].meshname;
$("odel"+d).addEventListener("click",function(){anakata_deleteMesh(this.name)},false)}b=a[d].vote;b!=""&&anakata_setVote(d,b=="true")}}function anakata_setVote(a,b){if(b){$("down"+a).style.color="#FFF";$("up"+a).style.color="#FF8B60";$("score"+a).style.color="#FF8B60"}else{$("up"+a).style.color="#FFF";$("down"+a).style.color="#9494FF";$("score"+a).style.color="#9494FF"}}
function anakata_updateVote(a,b,d){if(b){$("down"+a).style.color="#FFF";$("up"+a).style.color="#FF8B60";$("score"+a).innerHTML=d;$("score"+a).morph("color: #FF8B60;",{duration:1})}else{$("up"+a).style.color="#FFF";$("down"+a).style.color="#9494FF";$("score"+a).innerHTML=d;$("score"+a).morph("color: #9494FF;",{duration:1})}}
function anakata_warpClick(){$("sliders").morph("opacity: 0;",{transition:"easeInCirc",duration:anakata_defaultDuration});$("sliders").style.zIndex=-1;anakata_shrinkList();anakata_isBox.each(function(a){a.value&&anakata_unloadDiv(a.key)})}function anakata_loadDiv(a){if(anakata_isNoBox()){$(a).style.zIndex=1664;var b=window.innerHeight/2;$(a).style.top=-window.innerHeight+"px";$(a).morph("top: "+b+"px",{duration:1.5,transition:"bounce",after:function(){anakata_isBox.set(a,true)}})}}
function anakata_unloadDiv(a){if(anakata_isBox.get(a)){$(a).style.zIndex=-1;$(a).style.top=-window.innerHeight+"px";anakata_isBox.set(a,false)}}function anakata_expandList(){if(!anakata_isMenu){$("navList").morph("left: 10px;",{transition:"spring",duration:anakata_defaultDuration});$("listExpander").morph("top: -50px;");anakata_isMenu=true}}
function anakata_shrinkList(){if(anakata_isMenu){$("navList").morph("left: -500px;",{transition:"swingFrom",duration:anakata_defaultDuration,after:function(){$("listExpander").morph("top: 10px;")}});anakata_isMenu=false}}function anakata_unFullScreentextArea(){if(anakata_fullScreenTextarea){$("section").removeChild(anakata_fullScreenTextarea);anakata_fullScreenTextarea.removeClassName("full-textarea");$("edit"+anakata_fullScreenTextarea.id).parentNode.appendChild(anakata_fullScreenTextarea)}}
function anakata_isNoBox(){var a=false;anakata_isBox.each(function(b){a=a||b.value});return!a};function anakata_initEvents(){$$(".navListElement").each(function(a){if(a.id.match(/^e/))a.addEventListener("click",window[a.id.replace(/^e/,"anakata_clickOn")],false);else a.id.match(/^w/)&&a.addEventListener("click",function(){anakata_shrinkList();anakata_addWidget("simple-"+a.id.replace(/^w/,"")+"-edit")},false)});$$(".simple").each(function(a){a.appendChild((new Element("div",{"class":"kill",id:"kill"+a.id})).update("x"));$("kill"+a.id).addEventListener("click",function(){anakata_remWidget(a.id)},
false);a.addEventListener("click",function(b){if(anakata_killMode||b.altKey||b.ctrlKey){anakata_killMode=false;document.body.style.cursor="default";anakata_remWidget(a.id)}},false);a.style.top=0;a.style.right=screen.width+"px"});$("wrap").addEventListener("click",anakata_warpClick,false);$("name").addEventListener("input",function(){$("nameoveredit").value=$("nameover").innerHTML=anakata_o.name=this.value},false);$("name").addEventListener("focus",function(){anakata_isHotkeysEnabled=false},false);
$("name").addEventListener("blur",function(){anakata_isHotkeysEnabled=true},false);$("nameover").addEventListener("click",function(){$("nameoveredit").morph("top: 10px",{transition:"bounce"});$("nameoveredit").focus()},false);$("nameoveredit").addEventListener("input",function(){$("nameover").innerHTML=$("name").value=anakata_o.name=this.value},false);$("nameoveredit").addEventListener("focus",function(){anakata_isHotkeysEnabled=false},false);$("nameoveredit").addEventListener("blur",function(){anakata_isHotkeysEnabled=
true},false);$("nameoveredit").addEventListener("blur",function(){$("nameoveredit").morph("top: -40px",{transition:"swingFrom"})},false);$("nameoveredit").addEventListener("keydown",function(a){a.keyCode==13&&$("nameoveredit").morph("top: -40px",{transition:"swingFrom"})},false);$("section").getElementsBySelector('input[type="range"]').each(function(a){a.addEventListener("input",function(){var b=a.id;if(b.indexOf("_simple")!=-1){var d=b.replace("_simple","");$("s"+d).innerHTML=$(d).value=this.value}else{d=
b+"_simple";$("s"+d).innerHTML=$(d).value=this.value}$("s"+b).innerHTML=anakata_o[b.replace("_simple","")]=parseFloat(this.value)},false);$("s"+a.id).addEventListener("click",function(){var b=a.id;if(b.indexOf("_simple")!=-1){var d=b.replace("_simple","");$(d).value=$("s"+d).innerHTML=$(d).value=0}else{d=b+"_simple";$(d).value=$("s"+d).innerHTML=$(d).value=0}$(b).value=$("s"+b).innerHTML=anakata_o[b.replace("_simple","")]=parseFloat(0)},false)});$("section").getElementsBySelector(".dual").each(function(a){a.ancestors()[0].appendChild((new Element("div",
{"class":"edit",id:"edit"+a.id})).update("Fullscreen"));$("edit"+a.id).addEventListener("click",function(){anakata_fullScreenTextarea=a;a.ancestors()[0].removeChild(a);$("section").appendChild(a);a.addClassName("full-textarea")},false);a.addEventListener("input",function(){try{var b=a.id;anakata_o[b.replace("_simple","")]=JSON.parse("["+this.value+"]");$(b).style.color!="#0A0"&&$(b).morph("color: #0A0;",{duration:anakata_defaultDuration});if(b.indexOf("_simple")!=-1){var d=b.replace("_simple","");
$(d).value=this.value}else $(b+"_simple").value=this.value}catch(e){$(b).morph("color: #A00;",{duration:anakata_defaultDuration})}},false);a.addEventListener("focus",function(){anakata_isHotkeysEnabled=false},false);a.addEventListener("blur",function(){anakata_isHotkeysEnabled=true},false)});$("description").addEventListener("input",function(){anakata_o.description=this.value},false);$("description").addEventListener("focus",function(){anakata_isHotkeysEnabled=false},false);$("description").addEventListener("blur",
function(){anakata_isHotkeysEnabled=true},false);$("login").addEventListener("focus",function(){anakata_isHotkeysEnabled=false},false);$("login").addEventListener("blur",function(){anakata_isHotkeysEnabled=true},false);$("passwd").addEventListener("focus",function(){anakata_isHotkeysEnabled=false},false);$("passwd").addEventListener("blur",function(){anakata_isHotkeysEnabled=true},false);$("oldpasswd").addEventListener("focus",function(){anakata_isHotkeysEnabled=false},false);$("oldpasswd").addEventListener("blur",
function(){anakata_isHotkeysEnabled=true},false);$("newpasswd").addEventListener("focus",function(){anakata_isHotkeysEnabled=false},false);$("newpasswd").addEventListener("blur",function(){anakata_isHotkeysEnabled=true},false);$("chpasswd").addEventListener("click",function(a){anakata_chpasswd(a)},false);$("save").addEventListener("click",anakata_save,false);$("reset").addEventListener("click",anakata_reset,false);$("load").addEventListener("click",function(){anakata_makeLoadDiv();anakata_loadDiv("loadDiv")},
false);$("listExpander").addEventListener("click",anakata_expandList,false);$("listShrinker").addEventListener("click",anakata_shrinkList,false);$("create").addEventListener("click",anakata_create,false);$("logmein").addEventListener("click",anakata_loginAttempt,false);$("email").appendChild((new Element("a",{href:"mailto:anakata.tk+credits@gmail.com"})).update("anakata.tk@gmail.com"))}function anakata_clickOnkill(){anakata_shrinkList();anakata_killMode=true;document.body.style.cursor="alias"}
function anakata_clickOnsave(){anakata_shrinkList();anakata_save()}function anakata_clickOnload(){anakata_shrinkList();anakata_makeLoadDiv();anakata_loadDiv("loadBox")}function anakata_clickOnreset(){anakata_shrinkList();anakata_reset()}function anakata_clickOnlogin(){anakata_shrinkList();$("elogin").innerHTML.match(/Logout.+/)?anakata_logout(true):anakata_loadDiv("loginBox")}function anakata_clickOnchpasswd(){anakata_shrinkList();anakata_loadDiv("chpasswdBox")}
function anakata_clickOnpublish(){anakata_shrinkList();anakata_publish()}function anakata_clickOnmesheslist(){anakata_shrinkList();anakata_loadMeshList()}function anakata_clickOnall(){anakata_shrinkList();$("sliders").style.zIndex=1337;$("sliders").morph("opacity: 0.75;",{transition:"easeInCirc",duration:anakata_defaultDuration})}function anakata_clickOnhelp(){anakata_shrinkList();anakata_loadDiv("helpBox")}function anakata_clickOncredits(){anakata_shrinkList();anakata_loadDiv("creditsBox")};function anakata_kpress(a){var b=a.keyCode,d=0.1,e=50;if(a.ctrlKey){d*=2;d/=2}if(a.altKey){d/=2;e*=2}b==27&&anakata_unFullScreentextArea();if(!anakata_isHotkeysEnabled)return true;if(b==65)anakata_xya+=d;else if(b==81)anakata_xya-=d;else if(b==90)anakata_xza+=d;else if(b==83)anakata_xza-=d;else if(b==69)anakata_xwa+=d;else if(b==68)anakata_xwa-=d;else if(b==82)anakata_yza+=d;else if(b==70)anakata_yza-=d;else if(b==84)anakata_ywa+=d;else if(b==71)anakata_ywa-=d;else if(b==89)anakata_zwa+=d;else if(b==
72)anakata_zwa-=d;else if(b==85)anakata_o.mX+=e;else if(b==74)anakata_o.mX-=e;else if(b==73)anakata_o.mY+=e;else if(b==75)anakata_o.mY-=e;else if(b==79)anakata_o.mZ+=e;else if(b==76)anakata_o.mZ-=e;else if(b==80)anakata_o.mW+=e;else if(b==77)anakata_o.mW-=e;else if(b==87)anakata_addWidget("simple-cam-edit");else if(b==88)anakata_addWidget("simple-speed-edit");else if(b==67)anakata_addWidget("simple-vertices-edit");else if(b==86)anakata_addWidget("simple-edges-edit");else if(b==66)anakata_addWidget("simple-edgescolor-edit");
else if(b==78)anakata_addWidget("simple-desc-edit");else if(b==188)anakata_addWidget("simple-misc-edit");else if(b==45)anakata_clickOnsave();else if(b==36)anakata_clickOnload();else if(b==46)anakata_clickOnreset();else if(b==118)anakata_startDrawing();else if(b==119)anakata_stopDrawing();else if(b==120){anakata_stopDrawing();anakata_timersNumber++;anakata_startDrawing()}else if(b==121){anakata_stopDrawing();anakata_timersNumber>0&&anakata_timersNumber--;anakata_startDrawing()}};function anakata_Message(a,b){this.message=a;this.level=b}
function anakata_info(a,b){if(anakata_isInfoDisplaying)anakata_infoQueue.push(new anakata_Message(a,b));else{anakata_isInfoDisplaying=true;var d;switch(b){case 0:d="#f00";break;case 1:case 3:d="#ff0";break;case 2:d="#77f";break;default:d="#fff"}$("info").innerHTML=a;$("info").style.left="-50%";var e=function(){anakata_isInfoDisplaying=false;if(anakata_infoQueue.size()>0){var f=anakata_infoQueue.shift();anakata_info(f.message,f.level)}};$("info").morph("left: 25%; color: "+d,{duration:0.4,transition:"bounce",
after:function(){setTimeout(function(){$("info").morph("left: 100%; color: #000;",{duration:0.4,transition:"easeFrom",after:e})},b==3?1E4:2E3)}})}};function anakata_projectTo2D(a){var b=1+a[2]*anakata_o.fov/anakata_o.mZ;return[anakata_o.mX+a[0]/b,anakata_o.mY-a[1]/b]}function anakata_projectTo3D(a){var b=1+a[3]*anakata_o.fov/anakata_o.mW;return[a[0]/b,a[1]/b,a[2]/b]}
function anakata_fastRot(a,b,d,e,f,g,i,h,j,m){var u=c(f);f=s(f);var w=c(g);g=s(g);var n=c(i);i=s(i);var o=c(h);h=s(h);var p=c(j);j=s(j);var q=c(m);m=s(m);var l=a;a=a*u+b*f;b=b*u-l*f;l=a;a=a*w+d*g;d=d*w-l*g;l=a;a=a*n+e*i;e=e*n-l*i;l=b;b=b*o+d*h;d=d*o-l*h;l=b;b=b*p+e*j;e=e*p-l*j;l=d;d=d*q+e*m;return[a,b,d,e*q-l*m]}
function anakata_updateAngles(){anakata_xya+=anakata_o.xyStep/1E3;anakata_xza+=anakata_o.xzStep/1E3;anakata_xwa+=anakata_o.xwStep/1E3;anakata_yza+=anakata_o.yzStep/1E3;anakata_ywa+=anakata_o.ywStep/1E3;anakata_zwa+=anakata_o.zwStep/1E3}function anakata_rotate(a){var b=anakata_o.vertices;return anakata_fastRot(b[a][0]*anakata_o.scale,b[a][1]*anakata_o.scale,b[a][2]*anakata_o.scale,b[a][3]*anakata_o.scale,anakata_xya,anakata_xza,anakata_xwa,anakata_yza,anakata_ywa,anakata_zwa)};function anakata_strokeMesh(){$("canvas").getContext("2d");var a=anakata_o.edges.length-1;do{var b=anakata_o.edges[a];anakata_c2d.lineWidth=anakata_o.lineWidth;anakata_c2d.beginPath();anakata_c2d.strokeStyle=anakata_o.edgesColor[a]?anakata_o.edgesColor[a]:"#fff";var d=b.length-1;try{do{var e=b[d],f=anakata_projectedVertices[e][0],g=anakata_projectedVertices[e][1];if(f<anakata_xClipMin)anakata_xClipMin=f;if(f>anakata_xClipMax)anakata_xClipMax=f;if(g<anakata_yClipMin)anakata_yClipMin=g;if(g>anakata_yClipMax)anakata_yClipMax=
g;d==b.length-1?anakata_c2d.moveTo(f,g):anakata_c2d.lineTo(f,g)}while(d--);anakata_c2d.stroke()}catch(i){anakata_infoQueue.length==0&&anakata_info("Error in edges list on : ["+b+"]\n Vertice "+e+" does not exist.",0)}}while(a--)}
function anakata_draw(){if(!anakata_busy){anakata_busy=true;anakata_updateAngles();var a=anakata_o.vertices.length-1;do anakata_projectedVertices[a]=anakata_projectTo2D(anakata_projectTo3D(anakata_rotate(a)));while(a--);a=2*anakata_o.lineWidth;anakata_c2d.clearRect(anakata_xClipMin-a,anakata_yClipMin-a,anakata_xClipMax-anakata_xClipMin+2*a,anakata_yClipMax-anakata_yClipMin+2*a);anakata_xClipMin=1E4;anakata_xClipMax=0;anakata_yClipMin=1E4;anakata_yClipMax=0;anakata_strokeMesh();anakata_frames++;anakata_busy=
false}}function anakata_fps(){$("fps").innerHTML=anakata_frames;anakata_frames=0}
function anakata_render(){if(document.createElement("canvas").getContext){anakata_initEvents();Prototype.Browser.Gecko&&anakata_info("/!\\ <br />You seem to use firefox, good !<br />But to see this engine run smoothly try an up-to-date webkit based browser like Google Chrome.<br /> It's like 4 times faster.",3);anakata_load(0);anakata_setValues();anakata_loginOnSession();document.addEventListener("keydown",anakata_kpress,false);$("canvas").width=window.innerWidth;$("canvas").height=window.innerHeight;
anakata_c2d=$("canvas").getContext("2d");anakata_c2d.lineCap="round";window.addEventListener("resize",anakata_resize,false);$("loading").morph("top: 100%",{duration:anakata_defaultDuration});$("loading").remove();anakata_startDrawing();anakata_fpsTimer=setInterval(function(){anakata_fps()},1E3)}else{$("loading").remove();document.body.innerHTML=$("canvas").innerHTML}}
function anakata_startDrawing(){anakata_stopDrawing();for(var a=0;a<anakata_timersNumber;a++)anakata_drawTimer[a]=setInterval(function(){anakata_draw()},5)}function anakata_stopDrawing(){for(var a=0;a<anakata_timersNumber;a++)clearInterval(anakata_drawTimer[a])}function anakata_resize(){$("canvas").width=window.innerWidth;$("canvas").height=window.innerHeight};function anakata_Settings(a,b){var d;if(a){d=b?a:JSON.parse(a);this.name=d.name;this.fov=parseFloat(d.fov);this.scale=parseFloat(d.scale);this.mX=parseFloat(d.mX);this.mY=parseFloat(d.mY);this.mZ=parseFloat(d.mZ);this.mW=parseFloat(d.mW);this.xyStep=parseFloat(d.xyStep);this.xzStep=parseFloat(d.xzStep);this.xwStep=parseFloat(d.xwStep);this.yzStep=parseFloat(d.yzStep);this.ywStep=parseFloat(d.ywStep);this.zwStep=parseFloat(d.zwStep);this.vertices=JSON.parse(d.vertices);this.edges=JSON.parse(d.edges);
this.edgesColor=JSON.parse(d.edgesColor);this.lineWidth=parseFloat(d.lineWidth);this.description=d.description}else this.reset()}
anakata_Settings.prototype={reset:function(){this.name="Tesseract";this.mX=window.innerWidth/2;this.mY=window.innerHeight/2;this.mW=this.mZ=500;this.fov=1;this.scale=100;this.xyStep=7;this.xzStep=10;this.xwStep=13;this.yzStep=9;this.ywStep=7;this.zwStep=15;this.vertices=[[-1,-1,-1,1],[1,-1,-1,1],[1,1,-1,1],[-1,1,-1,1],[-1,-1,1,1],[1,-1,1,1],[1,1,1,1],[-1,1,1,1],[-1,-1,-1,-1],[1,-1,-1,-1],[1,1,-1,-1],[-1,1,-1,-1],[-1,-1,1,-1],[1,-1,1,-1],[1,1,1,-1],[-1,1,1,-1]];this.edges=[[0,1,2,3,0,4,5,6,7,4],[8,
9,10,11,8,12,13,14,15,12],[1,5],[2,6],[3,7],[9,13],[10,14],[11,15],[0,8],[1,9],[2,10],[3,11],[4,12],[5,13],[6,14],[7,15]];this.edgesColor=["#0f0","#f00","#0f0","#0f0","#0f0","#f00","#f00","#f00","#66f","#66f","#66f","#66f","#00f","#00f","#00f","#00f"];this.lineWidth=0.5;this.description="A simple 4 dimensions hypercube"}};function anakata_setValues(){$H(anakata_o).each(function(a){if(typeof a.value!=="function")if(a.key=="name")$("nameoveredit").value=$("nameover").innerHTML=$(a.key).value=a.value;else if(a.key=="description")$("description").value=a.value;else if(a.key!="vertices"&&a.key!="edges"&&a.key!="edgesColor")$("s"+a.key+"_simple").innerHTML=$(a.key+"_simple").value=$("s"+a.key).innerHTML=$(a.key).value=a.value;else if(a.key=="edgesColor")$(a.key+"_simple").innerHTML=$(a.key).value=JSON.stringify(a.value).replace(/(^\"|\"$|\\|\[|\])/g,
"").replace(/, /g,",\n");else $(a.key+"_simple").innerHTML=$(a.key).value=JSON.stringify(a.value).replace(/\"/g,"").replace(/\[\[/,"[").replace(/\]\]/,"]").replace(/\],\s?/g,"],\n")})}function anakata_loadUnsavedMesh(a){anakata_o=new anakata_Settings(a,true);anakata_setValues();anakata_info("Mesh "+anakata_o.name+" has been loaded",2)}
function anakata_save(){$H(anakata_o).each(function(a){if(typeof a.value!=="function")a.value=$(a.key).value});localStorage.setItem(anakata_o.name,JSON.stringify(anakata_o));anakata_info("Mesh "+anakata_o.name+" has been saved",2)}function anakata_reset(){localStorage.clear();anakata_o.reset();anakata_setValues();anakata_info("Local storage has been cleared",2)}
function anakata_load(a){if(localStorage.length>a){anakata_o=new anakata_Settings(localStorage.getItem(localStorage.key(a)),false);anakata_setValues();anakata_info("Mesh "+anakata_o.name+" has been loaded",2)}else{anakata_o=new anakata_Settings(null,false);anakata_info("No saved mesh has been found, loading defaults",2)}}function anakata_del(a){localStorage.removeItem(localStorage.key(a));$("mesh"+a).remove();anakata_info("Mesh has been deleted",2)};function anakata_Midget(a){this.widget=a;this.right=this.top=0}
function anakata_reArrangeWidgets(){var a=10,b=10,d=10;anakata_midgets.sort(anakata_byHeight);anakata_midgets.each(function(e){if(b+e.widget.offsetHeight>window.innerHeight){b=10;a+=e.widget.offsetWidth+10;e.top=10}else e.top=b;e.right=a;b+=e.widget.offsetHeight+10;e.widget.style.zIndex=d++});anakata_midgets.each(function(e){e.widget.morph("top: "+e.top+"px; right: "+e.right+"px;",{transition:"bounce",duration:anakata_defaultDuration,propertyTransitions:{top:"easeTo"}})})}
function anakata_addWidget(a){if(anakata_widgetsOpen.indexOf(a)!=-1)anakata_remWidget(a);else{anakata_midgets.push(new anakata_Midget($(a),0,0));anakata_widgetsOpen.push(a);anakata_reArrangeWidgets()}}
function anakata_remWidget(a){anakata_widgetsOpen=anakata_widgetsOpen.without(a);var b;anakata_midgets.each(function(d){if(d.widget.id==a)b=d});anakata_midgets=anakata_midgets.without(b);$(a).morph("right: "+window.innerWidth+"px;",{transition:"easeInExpo",duration:anakata_defaultDuration});anakata_reArrangeWidgets()}function anakata_byHeight(a,b){return b.widget.offsetHeight-a.widget.offsetHeight};function anakata_create(){anakata_setWIP();new Ajax.Request("/nosql/create-user.php",{method:"post",parameters:{username:$("login").value,passwd:MD5(SHA1(MD5($("passwd").value)))},onSuccess:function(a){anakata_rmWIP();switch(JSON.parse(a.responseText).status){case 200:anakata_info("User "+$("login").value+" has been succesfully created. You can now login.",1);break;case 400:anakata_info("400 - You must provide a login and a password",0);break;case 409:anakata_info("409 - User "+$("login").value+" already exist. Try another.",
0);break;case 500:anakata_info("500 - Sever is slowly dying right now, sorry try again later (and donate :) )",0);break}},onFailure:function(){anakata_rmWIP();anakata_info("Request failed, please report : "+transport.responseText,0)}})}
function anakata_loginAttempt(){anakata_setWIP();new Ajax.Request("/nosql/get-user-auth.php",{method:"post",parameters:{username:$("login").value,passwd:MD5(SHA1(MD5($("passwd").value)))},onSuccess:function(a){anakata_rmWIP();a=JSON.parse(a.responseText);switch(a.status){case 200:var b=$("login").value;anakata_info("Welcome  "+b+"!",1);$("elogin").innerHTML="Logout ("+b+")";sessionStorage.setItem("login",b);sessionStorage.setItem("key",a.key);anakata_unloadDiv("loginBox");break;case 403:anakata_info("403 - Bad password try again  ",
0);break;case 404:anakata_info("404 - User "+$("login").value+" not found",0);break;case 500:anakata_info("500 - Sever is slowly dying right now, sorry try again later (and donate :) )",0);break}},onFailure:function(a){anakata_rmWIP();anakata_info("Request failed, please report : "+a.responseText,0)}})}function anakata_loginOnSession(){var a=sessionStorage.getItem("login"),b=sessionStorage.getItem("key");if(a&&b){anakata_info("Welcome  "+a+"!",1);$("elogin").innerHTML="Logout ("+a+")"}}
function anakata_logout(a){var b=sessionStorage.getItem("login");sessionStorage.clear();a&&anakata_info("User "+b+" is now logged out",1);$("elogin").innerHTML="Login"}
function anakata_chpasswd(){anakata_setWIP();new Ajax.Request("/nosql/change-password.php",{method:"post",parameters:{username:sessionStorage.getItem("login"),key:sessionStorage.getItem("key"),oldpasswd:MD5(SHA1(MD5($("oldpasswd").value))),newpasswd:MD5(SHA1(MD5($("newpasswd").value)))},onSuccess:function(a){anakata_rmWIP();switch(JSON.parse(a.responseText).status){case 200:anakata_info("Password has been succesfully updated",1);anakata_unloadDiv("chpasswdBox");break;case 403:anakata_info("403 - Bad password try again  ",
0);break;case 404:anakata_info("404 - User "+$("login").value+" not found",0);break;case 426:anakata_info("426 - Session has expired ! Try logging again",0);anakata_logout(false);break;case 500:anakata_info("500 - Sever is slowly dying right now, sorry try again later (and donate :) )",0);break}},onFailure:function(a){anakata_rmWIP();anakata_info("Request failed, please report : "+a.responseText,0)}})}
function anakata_vote(a,b,d){anakata_setWIP();new Ajax.Request("/nosql/vote.php",{method:"post",parameters:{username:sessionStorage.getItem("login"),key:sessionStorage.getItem("key"),meshname:a,up:b},onSuccess:function(e){anakata_rmWIP();e=JSON.parse(e.responseText);switch(e.status){case 200:anakata_updateVote(d,b,e.score);break;case 403:anakata_info("403 - Bad password try again  ",0);break;case 404:anakata_info("404 - User "+$("login").value+" not found",0);break;case 426:anakata_info("426 - Session has expired ! Try logging again",
0);anakata_logout(false);break;case 500:anakata_info("500 - Sever is slowly dying right now, sorry try again later (and donate :) )",0);break}},onFailure:function(e){anakata_rmWIP();anakata_info("Request failed, please report : "+e.responseText,0)}})}
function anakata_publish(){anakata_setWIP();new Ajax.Request("/nosql/set-mesh.php",{method:"post",parameters:{username:sessionStorage.getItem("login"),key:sessionStorage.getItem("key"),meshname:anakata_o.name,mesh:JSON.stringify(anakata_o)},onSuccess:function(a){anakata_rmWIP();a=JSON.parse(a.responseText);switch(a.status){case 200:anakata_info("Mesh "+anakata_o.name+" has been succesfully uploaded.",1);break;case 400:anakata_info("400 - You are not logged in. Please do so.",0);break;case 403:anakata_info("403 - Unauthorized. Try logging again.",
0);anakata_logout(false);break;case 404:anakata_info("404 - Session not found ! Try logging again",0);anakata_logout(false);break;case 409:anakata_info("409 - The mesh name "+anakata_o.name+" is already taken by user "+a.originalUserName+". Please chose an other name.",0);break;case 426:anakata_info("426 - Session has expired ! Try logging again",0);anakata_logout(false);break;case 500:anakata_info("500 - Sever is slowly dying right now, sorry try again later (and donate :) )",0);break}},onFailure:function(){anakata_rmWIP();
anakata_info("Request failed, please report : "+transport.responseText,0)}})}
function anakata_loadMeshList(){anakata_setWIP();new Ajax.Request("/nosql/get-meshes.php",{method:"post",parameters:{username:sessionStorage.getItem("login"),key:sessionStorage.getItem("key")},onSuccess:function(a){anakata_rmWIP();a=JSON.parse(a.responseText);switch(a.status){case 200:anakata_makeLoadOnlineDiv(a.meshes);anakata_loadDiv("loadOnlineBox");break;case 400:anakata_info("400 - You are not logged in. Please do so.",0);break;case 403:anakata_info("403 - Unauthorized. Try logging again.",0);
anakata_logout(false);break;case 404:anakata_info("404 - Session not found ! Try logging again",0);anakata_logout(false);break;case 426:anakata_info("426 - Session has expired ! Try logging again",0);anakata_logout(false);break;case 500:anakata_info("500 - Sever is slowly dying right now, sorry try again later (and donate :) )",0);break}},onFailure:function(){anakata_rmWIP();anakata_info("Request failed, please report : "+transport.responseText,0)}})}
function anakata_loadMesh(a){anakata_setWIP();new Ajax.Request("/nosql/get-mesh.php",{method:"post",parameters:{username:sessionStorage.getItem("login"),key:sessionStorage.getItem("key"),meshname:a},onSuccess:function(b){anakata_rmWIP();b=JSON.parse(b.responseText);switch(b.status){case 200:anakata_loadUnsavedMesh(b.mesh);break;case 400:anakata_info("400 - You are not logged in. Please do so.",0);break;case 403:anakata_info("403 - Unauthorized. Try logging again.",0);anakata_logout(false);break;case 404:anakata_info("404 - Session not found ! Try logging again",
0);anakata_logout(false);break;case 426:anakata_info("426 - Session has expired ! Try logging again",0);anakata_logout(false);break;case 500:anakata_info("500 - Sever is slowly dying right now, sorry try again later (and donate :) )",0);break}},onFailure:function(){anakata_rmWIP();anakata_info("Request failed, please report : "+transport.responseText,0)}})}
function anakata_deleteMesh(a){anakata_setWIP();new Ajax.Request("/nosql/rm-mesh.php",{method:"post",parameters:{username:sessionStorage.getItem("login"),key:sessionStorage.getItem("key"),meshname:a},onSuccess:function(b){anakata_rmWIP();b=JSON.parse(b.responseText);switch(b.status){case 200:anakata_info("Mesh "+a+" has been succesfully deleted",1);anakata_unloadDiv("loadOnlineBox");break;case 400:anakata_info("400 - You are not logged in. Please do so.",0);break;case 403:anakata_info("403 - Unauthorized. Try logging again.",
0);anakata_logout(false);break;case 404:anakata_info("404 - Session not found ! Try logging again",0);anakata_logout(false);break;case 409:anakata_info("409 - The mesh "+anakata_o.name+" belongs to user "+b.originalUserName+"!!",0);break;case 426:anakata_info("426 - Session has expired ! Try logging again",0);anakata_logout(false);break;case 500:anakata_info("500 - Sever is slowly dying right now, sorry try again later (and donate :) )",0);break}},onFailure:function(){anakata_rmWIP();anakata_info("Request failed, please report : "+
transport.responseText,0)}})}function anakata_setWIP(){$("animLoad").style.opacity=1;anakata_xhrDone=false;glowUp()}function glowUp(){for(var a=1;a<11;a++)$("al"+a).morph("top: 5px;",{duration:0.5,delay:a/10,transition:"bouncePast"});setTimeout(glowDown,1500)}function glowDown(){for(var a=1;a<11;a++)$("al"+a).morph("top: 30px;",{duration:0.5,delay:a/10});anakata_xhrDone||setTimeout(glowUp,1500)}function anakata_rmWIP(){anakata_xhrDone=true};function SHA1(a){function b(r,v){return r<<v|r>>>32-v}function d(r){var v="",y;for(y=7;y>=0;y--)v+=(r>>>y*4&15).toString(16);return v}var e,f,g=new Array(80),i=1732584193,h=4023233417,j=2562383102,m=271733878,u=3285377520,w,n,o,p,q;a=function(r){r=r.replace(/\r\n/g,"\n");for(var v="",y=0;y<r.length;y++){var z=r.charCodeAt(y);if(z<128)v+=String.fromCharCode(z);else{if(z>127&&z<2048)v+=String.fromCharCode(z>>6|192);else{v+=String.fromCharCode(z>>12|224);v+=String.fromCharCode(z>>6&63|128)}v+=String.fromCharCode(z&
63|128)}}return v}(a);w=a.length;var l=[];for(e=0;e<w-3;e+=4){f=a.charCodeAt(e)<<24|a.charCodeAt(e+1)<<16|a.charCodeAt(e+2)<<8|a.charCodeAt(e+3);l.push(f)}switch(w%4){case 0:e=2147483648;break;case 1:e=a.charCodeAt(w-1)<<24|8388608;break;case 2:e=a.charCodeAt(w-2)<<24|a.charCodeAt(w-1)<<16|32768;break;case 3:e=a.charCodeAt(w-3)<<24|a.charCodeAt(w-2)<<16|a.charCodeAt(w-1)<<8|128;break}for(l.push(e);l.length%16!=14;)l.push(0);l.push(w>>>29);l.push(w<<3&4294967295);for(a=0;a<l.length;a+=16){for(e=0;e<
16;e++)g[e]=l[a+e];for(e=16;e<=79;e++)g[e]=b(g[e-3]^g[e-8]^g[e-14]^g[e-16],1);f=i;w=h;n=j;o=m;p=u;for(e=0;e<=19;e++){q=b(f,5)+(w&n|~w&o)+p+g[e]+1518500249&4294967295;p=o;o=n;n=b(w,30);w=f;f=q}for(e=20;e<=39;e++){q=b(f,5)+(w^n^o)+p+g[e]+1859775393&4294967295;p=o;o=n;n=b(w,30);w=f;f=q}for(e=40;e<=59;e++){q=b(f,5)+(w&n|w&o|n&o)+p+g[e]+2400959708&4294967295;p=o;o=n;n=b(w,30);w=f;f=q}for(e=60;e<=79;e++){q=b(f,5)+(w^n^o)+p+g[e]+3395469782&4294967295;p=o;o=n;n=b(w,30);w=f;f=q}i=i+f&4294967295;h=h+w&4294967295;
j=j+n&4294967295;m=m+o&4294967295;u=u+p&4294967295}q=d(i)+d(h)+d(j)+d(m)+d(u);return q.toLowerCase()}
var MD5=function(a){function b(l,r){var v,y,z,B,x;z=l&2147483648;B=r&2147483648;v=l&1073741824;y=r&1073741824;x=(l&1073741823)+(r&1073741823);if(v&y)return x^2147483648^z^B;return v|y?x&1073741824?x^3221225472^z^B:x^1073741824^z^B:x^z^B}function d(l,r,v,y,z,B,x){l=b(l,b(b(r&v|~r&y,z),x));return b(l<<B|l>>>32-B,r)}function e(l,r,v,y,z,B,x){l=b(l,b(b(r&y|v&~y,z),x));return b(l<<B|l>>>32-B,r)}function f(l,r,v,y,z,B,x){l=b(l,b(b(r^v^y,z),x));return b(l<<B|l>>>32-B,r)}function g(l,r,v,y,z,B,x){l=b(l,b(b(v^
(r|~y),z),x));return b(l<<B|l>>>32-B,r)}function i(l){var r="",v="",y;for(y=0;y<=3;y++){v="0"+(l>>>y*8&255).toString(16);r+=v.substr(v.length-2,2)}return r}var h=Array(),j,m,u,w,n,o,p,q;a=function(l){l=l.replace(/\r\n/g,"\n");for(var r="",v=0;v<l.length;v++){var y=l.charCodeAt(v);if(y<128)r+=String.fromCharCode(y);else{if(y>127&&y<2048)r+=String.fromCharCode(y>>6|192);else{r+=String.fromCharCode(y>>12|224);r+=String.fromCharCode(y>>6&63|128)}r+=String.fromCharCode(y&63|128)}}return r}(a);h=function(l){var r=
l.length,v=r+8;v=((v-v%64)/64+1)*16;for(var y=Array(v-1),z=0;z<r;){y[(z-z%4)/4]|=l.charCodeAt(z)<<z%4*8;z++}y[(z-z%4)/4]|=128<<z%4*8;y[v-2]=r<<3;y[v-1]=r>>>29;return y}(a);n=1732584193;o=4023233417;p=2562383102;q=271733878;for(a=0;a<h.length;a+=16){j=n;m=o;u=p;w=q;n=d(n,o,p,q,h[a+0],7,3614090360);q=d(q,n,o,p,h[a+1],12,3905402710);p=d(p,q,n,o,h[a+2],17,606105819);o=d(o,p,q,n,h[a+3],22,3250441966);n=d(n,o,p,q,h[a+4],7,4118548399);q=d(q,n,o,p,h[a+5],12,1200080426);p=d(p,q,n,o,h[a+6],17,2821735955);o=
d(o,p,q,n,h[a+7],22,4249261313);n=d(n,o,p,q,h[a+8],7,1770035416);q=d(q,n,o,p,h[a+9],12,2336552879);p=d(p,q,n,o,h[a+10],17,4294925233);o=d(o,p,q,n,h[a+11],22,2304563134);n=d(n,o,p,q,h[a+12],7,1804603682);q=d(q,n,o,p,h[a+13],12,4254626195);p=d(p,q,n,o,h[a+14],17,2792965006);o=d(o,p,q,n,h[a+15],22,1236535329);n=e(n,o,p,q,h[a+1],5,4129170786);q=e(q,n,o,p,h[a+6],9,3225465664);p=e(p,q,n,o,h[a+11],14,643717713);o=e(o,p,q,n,h[a+0],20,3921069994);n=e(n,o,p,q,h[a+5],5,3593408605);q=e(q,n,o,p,h[a+10],9,38016083);
p=e(p,q,n,o,h[a+15],14,3634488961);o=e(o,p,q,n,h[a+4],20,3889429448);n=e(n,o,p,q,h[a+9],5,568446438);q=e(q,n,o,p,h[a+14],9,3275163606);p=e(p,q,n,o,h[a+3],14,4107603335);o=e(o,p,q,n,h[a+8],20,1163531501);n=e(n,o,p,q,h[a+13],5,2850285829);q=e(q,n,o,p,h[a+2],9,4243563512);p=e(p,q,n,o,h[a+7],14,1735328473);o=e(o,p,q,n,h[a+12],20,2368359562);n=f(n,o,p,q,h[a+5],4,4294588738);q=f(q,n,o,p,h[a+8],11,2272392833);p=f(p,q,n,o,h[a+11],16,1839030562);o=f(o,p,q,n,h[a+14],23,4259657740);n=f(n,o,p,q,h[a+1],4,2763975236);
q=f(q,n,o,p,h[a+4],11,1272893353);p=f(p,q,n,o,h[a+7],16,4139469664);o=f(o,p,q,n,h[a+10],23,3200236656);n=f(n,o,p,q,h[a+13],4,681279174);q=f(q,n,o,p,h[a+0],11,3936430074);p=f(p,q,n,o,h[a+3],16,3572445317);o=f(o,p,q,n,h[a+6],23,76029189);n=f(n,o,p,q,h[a+9],4,3654602809);q=f(q,n,o,p,h[a+12],11,3873151461);p=f(p,q,n,o,h[a+15],16,530742520);o=f(o,p,q,n,h[a+2],23,3299628645);n=g(n,o,p,q,h[a+0],6,4096336452);q=g(q,n,o,p,h[a+7],10,1126891415);p=g(p,q,n,o,h[a+14],15,2878612391);o=g(o,p,q,n,h[a+5],21,4237533241);
n=g(n,o,p,q,h[a+12],6,1700485571);q=g(q,n,o,p,h[a+3],10,2399980690);p=g(p,q,n,o,h[a+10],15,4293915773);o=g(o,p,q,n,h[a+1],21,2240044497);n=g(n,o,p,q,h[a+8],6,1873313359);q=g(q,n,o,p,h[a+15],10,4264355552);p=g(p,q,n,o,h[a+6],15,2734768916);o=g(o,p,q,n,h[a+13],21,1309151649);n=g(n,o,p,q,h[a+4],6,4149444226);q=g(q,n,o,p,h[a+11],10,3174756917);p=g(p,q,n,o,h[a+2],15,718787259);o=g(o,p,q,n,h[a+9],21,3951481745);n=b(n,j);o=b(o,m);p=b(p,u);q=b(q,w)}return(i(n)+i(o)+i(p)+i(q)).toLowerCase()};
